{"files":[{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","assets.rs"],"content":"pub const CYTOSCAPE_JS: &str = include_str!(\"assets/cytoscape.min.js\");\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","css.rs"],"content":"use crate::types::{FileAnalysis, ImportEntry, ImportKind};\n\nuse super::regexes::regex_css_import;\n\npub(crate) fn analyze_css_file(content: &str, relative: String) -> FileAnalysis {\n    let mut imports = Vec::new();\n    for caps in regex_css_import().captures_iter(content) {\n        let source = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").to_string();\n        imports.push(ImportEntry {\n            source,\n            kind: ImportKind::Static,\n        });\n    }\n\n    FileAnalysis {\n        path: relative,\n        loc: 0,\n        imports,\n        reexports: Vec::new(),\n        dynamic_imports: Vec::new(),\n        exports: Vec::new(),\n        command_calls: Vec::new(),\n        command_handlers: Vec::new(),\n    }\n}\n","traces":[{"line":5,"address":[],"length":0,"stats":{"Line":0}},{"line":6,"address":[],"length":0,"stats":{"Line":0}},{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":12},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","html.rs"],"content":"use std::fs;\nuse std::io;\nuse std::path::Path;\n\nuse super::assets::CYTOSCAPE_JS;\nuse super::open_server::url_encode_component;\nuse super::ReportSection;\n\nfn escape_html(raw: &str) -> String {\n    raw.replace('&', \"&amp;\")\n        .replace('<', \"&lt;\")\n        .replace('>', \"&gt;\")\n        .replace('\"', \"&quot;\")\n}\n\nfn linkify(base: Option<&str>, file: &str, line: usize) -> String {\n    if let Some(base) = base {\n        let href = format!(\"{}/open?f={}&l={}\", base, url_encode_component(file), line);\n        format!(\"<a href=\\\"{}\\\">{}:{}</a>\", href, file, line)\n    } else {\n        format!(\"{}:{}\", file, line)\n    }\n}\n\npub(crate) fn render_html_report(path: &Path, sections: &[ReportSection]) -> io::Result<()> {\n    if let Some(dir) = path.parent() {\n        fs::create_dir_all(dir)?;\n        let js_path = dir.join(\"loctree-cytoscape.min.js\");\n        if !js_path.exists() {\n            fs::write(&js_path, CYTOSCAPE_JS)?;\n        }\n    }\n\n    let mut out = String::new();\n    out.push_str(\n        r#\"<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'self'; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; connect-src 'none'; font-src 'self' data:;\">\n<title>loctree import/export report</title>\n<style>\nbody{font-family:system-ui,-apple-system,Segoe UI,Helvetica,Arial,sans-serif;margin:24px;line-height:1.5;}\nh1,h2,h3{margin-bottom:0.2em;}\ntable{border-collapse:collapse;width:100%;margin:0.5em 0;}\nth,td{border:1px solid #ddd;padding:6px 8px;font-size:14px;}\nth{background:#f5f5f5;text-align:left;}\ncode{background:#f6f8fa;padding:2px 4px;border-radius:4px;}\n.muted{color:#666;}\n.graph{height:520px;border:1px solid #ddd;border-radius:8px;margin:12px 0;}\n.command-table td{vertical-align:top;}\n.command-list{margin:0;padding-left:1.1rem;columns:2;column-gap:1.4rem;list-style:disc;}\n.command-list li{break-inside:avoid;word-break:break-word;margin-bottom:4px;}\n.graph-toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:6px 0 4px;}\n.graph-toolbar label,.graph-legend{font-size:13px;color:#444;display:flex;align-items:center;gap:8px;}\n.graph-legend{gap:12px;}\n.legend-dot{width:12px;height:12px;border-radius:50%;display:inline-block;}\n.graph-hint{font-size:12px;color:#555;margin:2px 0 6px;}\n.graph-empty{font-size:13px;color:#777;text-align:center;padding:24px;}\n.graph-controls button{font-size:12px;padding:4px 8px;border:1px solid #ccc;background:#f8f8f8;border-radius:6px;cursor:pointer;}\n.graph-controls button:hover{background:#eee;}\n.command-table th,.command-table td{vertical-align:top;}\n.command-table code{background:transparent;color:inherit;font-weight:600;}\n.command-pill{display:inline-block;padding:3px 6px;border-radius:6px;background:#eef2ff;color:#2b2f3a;font-size:12px;margin:2px 4px 2px 0;}\n.dark .command-pill{background:#1f2635;color:#e9ecf5;}\n.command-col{width:50%;}\n.module-header{font-weight:700;margin-top:4px;}\n.module-group{margin-bottom:10px;}\n.graph-drawer{position:fixed;left:16px;right:16px;bottom:12px;z-index:1100;background:#f5f7fb;border:1px solid #cfd4de;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.25);padding:8px 10px;}\n.graph-drawer.collapsed{opacity:0.9;}\n.graph-drawer-header{display:flex;align-items:center;gap:10px;cursor:pointer;font-weight:600;}\n.graph-drawer-header button{font-size:12px;padding:4px 8px;border:1px solid #ccc;background:#fff;border-radius:6px;cursor:pointer;}\n.graph-drawer-body{margin-top:6px;}\n.graph-drawer .graph{margin:0;border-color:#cfd4de;}\n.dark body{background:#0f1115;color:#d7dde5;}\n.dark table th{background:#1c2029;color:#d7dde5;}\n.dark table td{background:#0f1115;color:#d7dde5;border-color:#2a2f3a;}\n.dark code{background:#1c2029;color:#f0f4ff;}\n.dark .graph{border-color:#2a2f3a;}\n.dark .graph-drawer{background:#0b0d11;border-color:#2a2f3a;box-shadow:0 8px 32px rgba(0,0,0,.45);}\n.dark .graph-drawer-header button{background:#111522;color:#e9ecf5;border-color:#2a2f3a;}\n</style>\n</head><body>\n<h1>loctree import/export analysis</h1>\n\"#,\n    );\n\n    for section in sections {\n        out.push_str(&format!(\n            \"<h2>{}</h2><p class=\\\"muted\\\">Files analyzed: {}</p>\",\n            escape_html(&section.root),\n            section.files_analyzed\n        ));\n\n        // AI Insights\n        if !section.insights.is_empty() {\n            out.push_str(\"<h3>AI Insights</h3><ul class=\\\"command-list\\\">\");\n            for insight in &section.insights {\n                 let color = match insight.severity.as_str() {\n                     \"high\" => \"#e74c3c\",\n                     \"medium\" => \"#e67e22\",\n                     _ => \"#3498db\",\n                 };\n                 out.push_str(&format!(\n                     \"<li><strong style=\\\"color:{}\\\">{}</strong>: {}</li>\",\n                     color,\n                     escape_html(&insight.title),\n                     escape_html(&insight.message)\n                 ));\n            }\n            out.push_str(\"</ul>\");\n        }\n\n        // Duplicate exports\n        out.push_str(\"<h3>Top duplicate exports</h3>\");\n        if section.ranked_dups.is_empty() {\n            out.push_str(\"<p class=\\\"muted\\\">None</p>\");\n        } else {\n            out.push_str(\"<table><tr><th>Symbol</th><th>Files</th><th>Prod</th><th>Dev</th><th>Canonical</th><th>Refactor targets</th></tr>\");\n            for dup in section.ranked_dups.iter().take(section.analyze_limit) {\n                out.push_str(&format!(\n                    \"<tr><td><code>{}</code></td><td>{}</td><td>{}</td><td>{}</td><td><code>{}</code></td><td>{}</td></tr>\",\n                    escape_html(&dup.name),\n                    dup.files.len(),\n                    dup.prod_count,\n                    dup.dev_count,\n                    escape_html(&dup.canonical),\n                    escape_html(&dup.refactors.join(\", \"))\n                ));\n            }\n            out.push_str(\"</table>\");\n        }\n\n        // Cascades\n        out.push_str(\"<h3>Re-export cascades</h3>\");\n        if section.cascades.is_empty() {\n            out.push_str(\"<p class=\\\"muted\\\">None</p>\");\n        } else {\n            out.push_str(\"<ul>\");\n            for (from, to) in &section.cascades {\n                out.push_str(&format!(\n                    \"<li><code>{}</code> → <code>{}</code></li>\",\n                    escape_html(from),\n                    escape_html(to)\n                ));\n            }\n            out.push_str(\"</ul>\");\n        }\n\n        // Dynamic imports\n        out.push_str(\"<h3>Dynamic imports</h3>\");\n        if section.dynamic.is_empty() {\n            out.push_str(\"<p class=\\\"muted\\\">None</p>\");\n        } else {\n            out.push_str(\"<table><tr><th>File</th><th>Sources</th></tr>\");\n            for (file, sources) in section.dynamic.iter().take(section.analyze_limit) {\n                out.push_str(&format!(\n                    \"<tr><td><code>{}</code></td><td>{}</td></tr>\",\n                    escape_html(file),\n                    escape_html(&sources.join(\", \"))\n                ));\n            }\n            out.push_str(\"</table>\");\n        }\n\n        // Command coverage\n        out.push_str(\"<h3>Tauri command coverage</h3>\");\n        if section.command_counts == (0, 0) {\n            out.push_str(\"<p class=\\\"muted\\\">No Tauri commands detected in this root.</p>\");\n        } else if section.missing_handlers.is_empty() && section.unused_handlers.is_empty() {\n            out.push_str(\"<p class=\\\"muted\\\">All frontend calls have matching handlers.</p>\");\n        } else {\n            let render_grouped = |gaps: &Vec<super::report::CommandGap>, out: &mut String| {\n                if gaps.is_empty() {\n                    out.push_str(\"<span class=\\\"muted\\\">None</span>\");\n                    return;\n                }\n                let mut groups: std::collections::BTreeMap<String, Vec<String>> =\n                    std::collections::BTreeMap::new();\n                for g in gaps {\n                    let module = g\n                        .locations\n                        .first()\n                        .map(|(p, _)| {\n                            let parts: Vec<&str> = p.split('/').collect();\n                            if parts.len() >= 2 {\n                                format!(\"{}/{}\", parts[0], parts[1])\n                            } else {\n                                parts.first().unwrap_or(&\"\").to_string()\n                            }\n                        })\n                        .unwrap_or_else(|| \"\".to_string());\n                    let locs: Vec<String> = g\n                        .locations\n                        .iter()\n                        .map(|(f, l)| linkify(section.open_base.as_deref(), f, *l))\n                        .collect();\n                    \n                    let alias_info = if let Some(impl_name) = &g.implementation_name {\n                         if impl_name != &g.name {\n                             format!(\" <span class=\\\"muted\\\">(impl: {})</span>\", escape_html(impl_name))\n                         } else {\n                             String::new()\n                         }\n                    } else {\n                         String::new()\n                    };\n\n                    let pill = format!(\n                        \"<span class=\\\"command-pill\\\"><code>{}</code>{}</span> <span class=\\\"muted\\\">{}</span>\",\n                        escape_html(&g.name),\n                        alias_info,\n                        locs.join(\", \")\n                    );\n                    groups.entry(module).or_default().push(pill);\n                }\n                for (module, items) in groups {\n                    let module_label = if module.is_empty() {\n                        \"—\".to_string()\n                    } else {\n                        escape_html(&module)\n                    };\n                    out.push_str(&format!(\n                        \"<div class=\\\"module-group\\\"><div class=\\\"module-header\\\">{}</div><div>{}</div></div>\",\n                        module_label,\n                        items.join(\"<br/>\")\n                    ));\n                }\n            };\n\n            out.push_str(\"<table class=\\\"command-table\\\"><tr><th>Missing handlers (FE→BE)</th><th>Handlers unused by FE</th></tr><tr><td>\");\n            render_grouped(&section.missing_handlers, &mut out);\n            out.push_str(\"</td><td>\");\n            render_grouped(&section.unused_handlers, &mut out);\n            out.push_str(\"</td></tr></table>\");\n        }\n\n        if let Some(graph) = &section.graph {\n            out.push_str(\"<h3>Import graph</h3>\");\n            out.push_str(&format!(\n                \"<div class=\\\"graph\\\" id=\\\"graph-{}\\\"></div>\",\n                escape_html(\n                    &section\n                        .root\n                        .replace(|c: char| !c.is_ascii_alphanumeric(), \"_\")\n                )\n            ));\n            let nodes_json = serde_json::to_string(&graph.nodes).unwrap_or(\"[]\".into());\n            let edges_json = serde_json::to_string(&graph.edges).unwrap_or(\"[]\".into());\n            out.push_str(\"<script>\");\n            out.push_str(\"window.__LOCTREE_GRAPHS = window.__LOCTREE_GRAPHS || [];\");\n            out.push_str(\"window.__LOCTREE_GRAPHS.push({\");\n            out.push_str(&format!(\n                \"id:\\\"graph-{}\\\",nodes:{},edges:{}\",\n                escape_html(\n                    &section\n                        .root\n                        .replace(|c: char| !c.is_ascii_alphanumeric(), \"_\")\n                ),\n                nodes_json,\n                edges_json\n            ));\n            out.push_str(\"});</script>\");\n        }\n    }\n\n    // Graph bootstrap (Cytoscape self-hosted)\n    out.push_str(\n        r#\"<script src=\"loctree-cytoscape.min.js\"></script>\n<script>\n(function(){\n  const graphs = window.__LOCTREE_GRAPHS || [];\n  graphs.forEach((g, idx) => {\n    const container = document.getElementById(g.id);\n    if (!container) return;\n\n    const useDrawer = graphs.length === 1;\n    let drawerBody = null;\n    if (useDrawer) {\n      const drawer = document.createElement('div');\n      drawer.className = 'graph-drawer';\n      const header = document.createElement('div');\n      header.className = 'graph-drawer-header';\n      header.innerHTML = '<button data-role=\"drawer-toggle\">hide graph</button><span>Import graph</span>';\n      drawerBody = document.createElement('div');\n      drawerBody.className = 'graph-drawer-body';\n      container.parentNode.insertBefore(drawer, container);\n      drawerBody.appendChild(container);\n      drawer.appendChild(header);\n      drawer.appendChild(drawerBody);\n      document.body.appendChild(drawer);\n      container.style.height = '460px';\n      const toggle = header.querySelector('[data-role=\"drawer-toggle\"]');\n      let collapsed = false;\n      const applyCollapse = () => {\n        drawer.classList.toggle('collapsed', collapsed);\n        drawerBody.style.display = collapsed ? 'none' : 'block';\n        toggle.textContent = collapsed ? 'show graph' : 'hide graph';\n      };\n      header.addEventListener('click', () => {\n        collapsed = !collapsed;\n        applyCollapse();\n      });\n      applyCollapse();\n    }\n\n    // Controls\n    const toolbar = document.createElement('div');\n    toolbar.className = 'graph-toolbar';\n    toolbar.innerHTML = `\n      <label>filter:\n        <input type=\"text\" size=\"18\" placeholder=\"substring (np. features/ai-suite, .tsx)\" data-role=\"filter-text\" />\n      </label>\n      <label>min degree:\n        <input type=\"number\" min=\"0\" value=\"0\" style=\"width:60px\" data-role=\"min-degree\" />\n      </label>\n      <label><input type=\"checkbox\" data-role=\"toggle-labels\" checked /> labels</label>\n      <span class=\"graph-controls\">\n        <button data-role=\"fit\">fit</button>\n        <button data-role=\"reset\">reset</button>\n        <label><input type=\"checkbox\" data-role=\"dark\" /> dark</label>\n        <button data-role=\"fullscreen\">fullscreen</button>\n        <button data-role=\"png\">png</button>\n        <button data-role=\"json\">json</button>\n      </span>\n      <div class=\"graph-legend\">\n        <span><span class=\"legend-dot\" style=\"background:#4f81e1\"></span> file</span>\n        <span><span class=\"legend-dot\" style=\"background:#888\"></span> import</span>\n        <span><span class=\"legend-dot\" style=\"background:#e67e22\"></span> re-export</span>\n      </div>\n    `;\n    const targetParent = drawerBody || container.parentNode;\n    targetParent.insertBefore(toolbar, container);\n    const hint = document.createElement('div');\n    hint.className = 'graph-hint';\n    hint.textContent = 'Filtr dopasowuje substring do ścieżki węzła (ścieżki są względne wobec roota). Ustaw min degree, aby ukryć liście.';\n    targetParent.insertBefore(hint, container);\n\n    const buildElements = () => {\n      const rawNodes = Array.isArray(g.nodes) ? g.nodes : [];\n      const rawEdges = Array.isArray(g.edges) ? g.edges : [];\n      const nodes = rawNodes.map(n => {\n        const size = Math.max(4, Math.min(30, Math.sqrt((n && n.loc) || 1)));\n        return {\n          data: { id: n.id || '', label: n.label || n.id || '', loc: n.loc || 0, size, full: n.id || '' },\n          position: { x: n.x || 0, y: n.y || 0 }\n        };\n      });\n      const edges = rawEdges.map((e, idx) => {\n        const kind = (e && e[2]) || 'import';\n        const color = kind === 'reexport' ? '#e67e22' : '#888';\n        return {\n          data: { id: 'e'+idx, source: e[0], target: e[1], label: kind, color }\n        };\n      });\n      return { nodes, edges };\n    };\n\n    const original = buildElements();\n    const emptyOverlay = document.createElement('div');\n    emptyOverlay.className = 'graph-empty';\n    emptyOverlay.style.display = 'none';\n    container.appendChild(emptyOverlay);\n    let cy = cytoscape({\n      container,\n      elements: original,\n      style: [\n        { selector: 'node', style: { 'label': 'data(label)', 'font-size': 10, 'text-wrap': 'wrap', 'text-max-width': 120, 'background-color': '#4f81e1', 'color': '#fff', 'width': 'data(size)', 'height': 'data(size)', 'overlay-padding': 8, 'overlay-opacity': 0 } },\n        { selector: 'edge', style: { 'curve-style': 'bezier', 'width': 1.1, 'line-color': 'data(color)', 'target-arrow-color': 'data(color)', 'target-arrow-shape': 'triangle', 'arrow-scale': 0.7, 'label': '', 'font-size': 9, 'text-background-color': '#fff', 'text-background-opacity': 0.8, 'text-background-padding': 2 } }\n      ],\n      layout: { name: 'preset', animate: false, fit: true }\n      });\n\n    const download = (filename, content, type) => {\n      const blob = new Blob([content], { type });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url; a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      setTimeout(() => URL.revokeObjectURL(url), 500);\n    };\n\n    const applyFilters = () => {\n      const text = (toolbar.querySelector('[data-role=\"filter-text\"]')?.value || '').toLowerCase();\n      const minDeg = parseInt(toolbar.querySelector('[data-role=\"min-degree\"]')?.value || '0', 10) || 0;\n\n      let nodes = original.nodes.map(n => ({\n        data: { ...n.data },\n        position: { ...n.position }\n      }));\n      if (text) {\n        nodes = nodes.filter(n => (n.data.id || '').toLowerCase().includes(text));\n      }\n      const nodeSet = new Set(nodes.map(n => n.data.id));\n      let edges = original.edges.map(e => ({ data: { ...e.data } }));\n      edges = edges.filter(e => nodeSet.has(e.data.source) && nodeSet.has(e.data.target));\n\n      if (minDeg > 0) {\n        const deg = {};\n        edges.forEach(e => {\n          deg[e.data.source] = (deg[e.data.source] || 0) + 1;\n          deg[e.data.target] = (deg[e.data.target] || 0) + 1;\n        });\n        nodes = nodes.filter(n => (deg[n.data.id] || 0) >= minDeg);\n        const filteredSet = new Set(nodes.map(n => n.data.id));\n        edges = edges.filter(e => filteredSet.has(e.data.source) && filteredSet.has(e.data.target));\n      }\n\n      if (nodes.length === 0) {\n        emptyOverlay.style.display = 'block';\n        cy.elements().remove();\n        return;\n      }\n      emptyOverlay.style.display = 'none';\n\n      cy.elements().remove();\n      cy.add({ nodes, edges });\n\n      const showLabels = toolbar.querySelector('[data-role=\"toggle-labels\"]').checked;\n      const autoHide = nodes.length > 800;\n      const labelsOn = showLabels && !autoHide;\n      cy.style()\n        .selector('node').style('label', labelsOn ? 'data(label)' : '')\n        .update();\n\n      cy.layout({ name: 'preset', animate: false, fit: true }).run();\n    };\n\n    // Fit / reset / dark / fullscreen\n    const fitBtn = toolbar.querySelector('[data-role=\"fit\"]');\n    const resetBtn = toolbar.querySelector('[data-role=\"reset\"]');\n    const darkChk = toolbar.querySelector('[data-role=\"dark\"]');\n    const fsBtn = toolbar.querySelector('[data-role=\"fullscreen\"]');\n    const pngBtn = toolbar.querySelector('[data-role=\"png\"]');\n    const jsonBtn = toolbar.querySelector('[data-role=\"json\"]');\n\n    if (fitBtn) fitBtn.addEventListener('click', () => cy.fit());\n    if (resetBtn) resetBtn.addEventListener('click', () => {\n      cy.elements().remove();\n      cy.add(original);\n      cy.layout({ name: 'preset', animate: false, fit: true }).run();\n      applyFilters();\n    });\n\n    if (pngBtn) pngBtn.addEventListener('click', () => {\n      const dark = darkChk && darkChk.checked;\n      const dataUrl = cy.png({ bg: dark ? '#0f1115' : '#ffffff', full: true, scale: 2 });\n      // cy.png already returns a data URL; use direct download to preserve format\n      const a = document.createElement('a');\n      a.href = dataUrl;\n      a.download = `${g.id}-graph.png`;\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n    });\n    if (jsonBtn) jsonBtn.addEventListener('click', () => {\n      const payload = {\n        nodes: cy.nodes().map(n => n.data()),\n        edges: cy.edges().map(e => ({ source: e.data('source'), target: e.data('target'), kind: e.data('kind') })),\n        filter: toolbar.querySelector('[data-role=\"filter-text\"]')?.value || '',\n        minDegree: parseInt(toolbar.querySelector('[data-role=\"min-degree\"]')?.value || '0', 10) || 0,\n      };\n      download(`${g.id}-graph.json`, JSON.stringify(payload, null, 2), 'application/json');\n    });\n\n    const applyDark = (on) => {\n      document.documentElement.classList.toggle('dark', on);\n      cy.style()\n        .selector('node').style('color', on ? '#eef2ff' : '#fff').update()\n        .selector('edge').style('text-background-color', on ? '#0f1115' : '#fff').update();\n    };\n    if (darkChk) {\n      darkChk.addEventListener('change', () => applyDark(darkChk.checked));\n    }\n\n    const fsTarget = container;\n    if (fsBtn && fsTarget && fsTarget.requestFullscreen) {\n      fsBtn.addEventListener('click', () => {\n        if (document.fullscreenElement) {\n          document.exitFullscreen();\n        } else {\n          fsTarget.requestFullscreen().catch(()=>{});\n        }\n      });\n      document.addEventListener('fullscreenchange', () => {\n        fsBtn.textContent = document.fullscreenElement ? 'exit fullscreen' : 'fullscreen';\n        if (!document.fullscreenElement) {\n          cy.fit();\n        }\n      });\n    }\n\n    // Tooltip on hover/click\n    const tooltip = document.createElement('div');\n    tooltip.style.position = 'fixed';\n    tooltip.style.pointerEvents = 'auto';\n    tooltip.style.background = '#111';\n    tooltip.style.color = '#fff';\n    tooltip.style.padding = '6px 8px';\n    tooltip.style.borderRadius = '6px';\n    tooltip.style.fontSize = '12px';\n    tooltip.style.display = 'none';\n    tooltip.style.zIndex = 9999;\n    document.body.appendChild(tooltip);\n\n    const showTip = (evt, node) => {\n        const data = node.data();\n        const path = data.full || data.id;\n        tooltip.innerHTML = `\n            <div style=\"margin-bottom:4px\"><strong>${path}</strong></div>\n            <div>LOC: ${data.loc || 0}</div>\n            <button style=\"margin-top:4px;font-size:10px;cursor:pointer\" onclick=\"navigator.clipboard.writeText('${path}')\">copy path</button>\n        `;\n        const rect = container.getBoundingClientRect();\n        const scrollX = window.scrollX || document.documentElement.scrollLeft || 0;\n        const scrollY = window.scrollY || document.documentElement.scrollTop || 0;\n        let left = rect.left + evt.renderedPosition.x + 12 + scrollX;\n        let top = rect.top + evt.renderedPosition.y + 12 + scrollY;\n        const maxLeft = scrollX + window.innerWidth - 220;\n        if (left > maxLeft) left = maxLeft;\n        tooltip.style.left = left + 'px';\n        tooltip.style.top = top + 'px';\n        tooltip.style.display = 'block';\n    };\n    const hideTip = () => { tooltip.style.display = 'none'; };\n\n    cy.off('mouseover');\n    cy.off('mouseout');\n    cy.off('tap');\n    cy.off('tapdrag');\n    cy.on('mouseover', 'node', (evt) => showTip(evt, evt.target));\n    cy.on('mouseout', 'node', hideTip);\n    cy.on('tap', 'node', (evt) => showTip(evt, evt.target));\n    cy.on('tapdrag', 'node', hideTip);\n\n    toolbar.querySelectorAll('input').forEach(inp => {\n      inp.addEventListener('input', () => applyFilters());\n      inp.addEventListener('change', () => applyFilters());\n    });\n  });\n})();\n</script>\"#,\n    );\n\n    out.push_str(\"</body></html>\");\n    fs::write(path, out)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::render_html_report;\n    use crate::analyzer::report::{AiInsight, RankedDup, ReportSection};\n    use std::fs;\n\n    #[test]\n    fn renders_basic_report() {\n        let tmp_dir = std::env::temp_dir().join(\"loctree_html_test\");\n        let _ = fs::remove_dir_all(&tmp_dir);\n        fs::create_dir_all(&tmp_dir).unwrap();\n        let out_path = tmp_dir.join(\"report.html\");\n\n        let dup = RankedDup {\n            name: \"Foo\".into(),\n            files: vec![\"a.ts\".into(), \"b.ts\".into()],\n            score: 2,\n            prod_count: 2,\n            dev_count: 0,\n            canonical: \"a.ts\".into(),\n            refactors: vec![\"b.ts\".into()],\n        };\n\n        let section = ReportSection {\n            root: \"test-root\".into(),\n            files_analyzed: 2,\n            ranked_dups: vec![dup],\n            cascades: vec![(\"a.ts\".into(), \"b.ts\".into())],\n            dynamic: vec![(\"dyn.ts\".into(), vec![\"./lazy\".into()])],\n            analyze_limit: 5,\n            missing_handlers: Vec::new(),\n            unused_handlers: Vec::new(),\n            command_counts: (0, 0),\n            open_base: None,\n            graph: None,\n            insights: vec![AiInsight {\n                title: \"Hint\".into(),\n                severity: \"medium\".into(),\n                message: \"Message\".into(),\n            }],\n        };\n\n        render_html_report(&out_path, &[section]).unwrap();\n        let html = fs::read_to_string(&out_path).unwrap();\n        assert!(html.contains(\"loctree import/export analysis\"));\n        assert!(html.contains(\"Hint\"));\n        assert!(html.contains(\"Foo\"));\n    }\n}\n","traces":[{"line":9,"address":[],"length":0,"stats":{"Line":10}},{"line":10,"address":[],"length":0,"stats":{"Line":50}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":1}},{"line":26,"address":[],"length":0,"stats":{"Line":2}},{"line":27,"address":[],"length":0,"stats":{"Line":2}},{"line":28,"address":[],"length":0,"stats":{"Line":3}},{"line":29,"address":[],"length":0,"stats":{"Line":1}},{"line":30,"address":[],"length":0,"stats":{"Line":2}},{"line":34,"address":[],"length":0,"stats":{"Line":2}},{"line":35,"address":[],"length":0,"stats":{"Line":2}},{"line":88,"address":[],"length":0,"stats":{"Line":3}},{"line":89,"address":[],"length":0,"stats":{"Line":4}},{"line":90,"address":[],"length":0,"stats":{"Line":2}},{"line":91,"address":[],"length":0,"stats":{"Line":1}},{"line":92,"address":[],"length":0,"stats":{"Line":1}},{"line":96,"address":[],"length":0,"stats":{"Line":1}},{"line":97,"address":[],"length":0,"stats":{"Line":3}},{"line":98,"address":[],"length":0,"stats":{"Line":3}},{"line":99,"address":[],"length":0,"stats":{"Line":2}},{"line":100,"address":[],"length":0,"stats":{"Line":1}},{"line":101,"address":[],"length":0,"stats":{"Line":2}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":4}},{"line":105,"address":[],"length":0,"stats":{"Line":2}},{"line":106,"address":[],"length":0,"stats":{"Line":1}},{"line":107,"address":[],"length":0,"stats":{"Line":3}},{"line":108,"address":[],"length":0,"stats":{"Line":1}},{"line":111,"address":[],"length":0,"stats":{"Line":3}},{"line":115,"address":[],"length":0,"stats":{"Line":3}},{"line":116,"address":[],"length":0,"stats":{"Line":2}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":3}},{"line":120,"address":[],"length":0,"stats":{"Line":5}},{"line":121,"address":[],"length":0,"stats":{"Line":4}},{"line":122,"address":[],"length":0,"stats":{"Line":2}},{"line":123,"address":[],"length":0,"stats":{"Line":3}},{"line":124,"address":[],"length":0,"stats":{"Line":3}},{"line":125,"address":[],"length":0,"stats":{"Line":1}},{"line":126,"address":[],"length":0,"stats":{"Line":1}},{"line":127,"address":[],"length":0,"stats":{"Line":3}},{"line":128,"address":[],"length":0,"stats":{"Line":3}},{"line":131,"address":[],"length":0,"stats":{"Line":3}},{"line":135,"address":[],"length":0,"stats":{"Line":3}},{"line":136,"address":[],"length":0,"stats":{"Line":2}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":3}},{"line":140,"address":[],"length":0,"stats":{"Line":5}},{"line":141,"address":[],"length":0,"stats":{"Line":4}},{"line":142,"address":[],"length":0,"stats":{"Line":2}},{"line":143,"address":[],"length":0,"stats":{"Line":3}},{"line":144,"address":[],"length":0,"stats":{"Line":1}},{"line":147,"address":[],"length":0,"stats":{"Line":3}},{"line":151,"address":[],"length":0,"stats":{"Line":3}},{"line":152,"address":[],"length":0,"stats":{"Line":2}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":3}},{"line":156,"address":[],"length":0,"stats":{"Line":6}},{"line":157,"address":[],"length":0,"stats":{"Line":4}},{"line":158,"address":[],"length":0,"stats":{"Line":2}},{"line":159,"address":[],"length":0,"stats":{"Line":3}},{"line":160,"address":[],"length":0,"stats":{"Line":3}},{"line":163,"address":[],"length":0,"stats":{"Line":3}},{"line":167,"address":[],"length":0,"stats":{"Line":3}},{"line":168,"address":[],"length":0,"stats":{"Line":2}},{"line":169,"address":[],"length":0,"stats":{"Line":2}},{"line":170,"address":[],"length":0,"stats":{"Line":1}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":1}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":2}},{"line":547,"address":[],"length":0,"stats":{"Line":3}},{"line":548,"address":[],"length":0,"stats":{"Line":3}}],"covered":66,"coverable":135},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","js.rs"],"content":"use std::collections::HashSet;\nuse std::path::Path;\n\nuse crate::types::{\n    CommandRef, ExportSymbol, FileAnalysis, ImportEntry, ImportKind, ReexportEntry, ReexportKind,\n};\n\nuse super::regexes::{\n    regex_dynamic_import, regex_export_brace, regex_export_default, regex_export_named_decl,\n    regex_import, regex_invoke_snake, regex_reexport_named, regex_reexport_star, regex_safe_invoke,\n    regex_side_effect_import, regex_tauri_invoke,\n};\nuse super::resolvers::resolve_reexport_target;\nuse super::{brace_list_to_names, offset_to_line};\n\npub(crate) fn analyze_js_file(\n    content: &str,\n    path: &Path,\n    root: &Path,\n    extensions: Option<&HashSet<String>>,\n    relative: String,\n) -> FileAnalysis {\n    let mut imports = Vec::new();\n    let mut command_calls = Vec::new();\n    for caps in regex_import().captures_iter(content) {\n        let source = caps.get(2).map(|m| m.as_str()).unwrap_or(\"\").to_string();\n        imports.push(ImportEntry {\n            source,\n            kind: ImportKind::Static,\n        });\n    }\n    for caps in regex_side_effect_import().captures_iter(content) {\n        let source = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").to_string();\n        imports.push(ImportEntry {\n            source,\n            kind: ImportKind::SideEffect,\n        });\n    }\n\n    for caps in regex_safe_invoke().captures_iter(content) {\n        if let Some(cmd) = caps.get(1) {\n            let line = offset_to_line(content, cmd.start());\n            command_calls.push(CommandRef {\n                name: cmd.as_str().to_string(),\n                exposed_name: None,\n                line,\n            });\n        }\n    }\n    for caps in regex_tauri_invoke().captures_iter(content) {\n        if let Some(cmd) = caps.get(1) {\n            let line = offset_to_line(content, cmd.start());\n            command_calls.push(CommandRef {\n                name: cmd.as_str().to_string(),\n                exposed_name: None,\n                line,\n            });\n        }\n    }\n    for caps in regex_invoke_snake().captures_iter(content) {\n        if let Some(cmd) = caps.get(1) {\n            let line = offset_to_line(content, cmd.start());\n            command_calls.push(CommandRef {\n                name: cmd.as_str().to_string(),\n                exposed_name: None,\n                line,\n            });\n        }\n    }\n\n    let mut reexports = Vec::new();\n    for caps in regex_reexport_star().captures_iter(content) {\n        let source = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").to_string();\n        let resolved = resolve_reexport_target(path, root, &source, extensions);\n        reexports.push(ReexportEntry {\n            source,\n            kind: ReexportKind::Star,\n            resolved,\n        });\n    }\n    for caps in regex_reexport_named().captures_iter(content) {\n        let raw_names = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\");\n        let source = caps.get(2).map(|m| m.as_str()).unwrap_or(\"\").to_string();\n        let names = brace_list_to_names(raw_names);\n        let resolved = resolve_reexport_target(path, root, &source, extensions);\n        reexports.push(ReexportEntry {\n            source,\n            kind: ReexportKind::Named(names.clone()),\n            resolved,\n        });\n    }\n\n    let mut dynamic_imports = Vec::new();\n    for caps in regex_dynamic_import().captures_iter(content) {\n        let source = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").to_string();\n        dynamic_imports.push(source);\n    }\n\n    let mut exports = Vec::new();\n    for caps in regex_export_named_decl().captures_iter(content) {\n        let name = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").to_string();\n        if !name.is_empty() {\n            exports.push(ExportSymbol {\n                name,\n                kind: \"decl\".to_string(),\n            });\n        }\n    }\n    for caps in regex_export_default().captures_iter(content) {\n        let name = caps\n            .get(1)\n            .map(|m| m.as_str().to_string())\n            .unwrap_or_else(|| \"default\".to_string());\n        exports.push(ExportSymbol {\n            name,\n            kind: \"default\".to_string(),\n        });\n    }\n    for caps in regex_export_brace().captures_iter(content) {\n        let raw = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\");\n        for name in brace_list_to_names(raw) {\n            exports.push(ExportSymbol {\n                name,\n                kind: \"named\".to_string(),\n            });\n        }\n    }\n    for re in &reexports {\n        if let ReexportKind::Named(names) = &re.kind {\n            for name in names {\n                exports.push(ExportSymbol {\n                    name: name.clone(),\n                    kind: \"reexport\".to_string(),\n                });\n            }\n        }\n    }\n\n    FileAnalysis {\n        path: relative,\n        loc: 0,\n        imports,\n        reexports,\n        dynamic_imports,\n        exports,\n        command_calls,\n        command_handlers: Vec::new(),\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::analyze_js_file;\n    use std::collections::HashSet;\n    use std::path::Path;\n\n    #[test]\n    fn detects_commands_reexports_and_exports() {\n        let content = r#\"\nimport defaultThing from \"./dep\";\nimport type { Foo } from \"./types\";\nimport \"./side.css\";\nexport { bar } from \"./reexports\";\nexport * from \"./star\";\nexport const localValue = 1;\nexport default function MyComp() {}\nexport { namedA, namedB as aliasB };\nconst dyn = import(\"./lazy\");\nsafeInvoke(\"cmd_safe\");\ninvokeSnake(\"cmd_snake\");\ninvoke(\"cmd_invoke\");\n        \"#;\n\n        let analysis = analyze_js_file(\n            content,\n            Path::new(\"src/app.tsx\"),\n            Path::new(\"src\"),\n            Some(&HashSet::from([\"ts\".to_string(), \"tsx\".to_string()])),\n            \"app.tsx\".to_string(),\n        );\n\n        assert!(analysis\n            .imports\n            .iter()\n            .any(|i| i.source == \"./dep\" && matches!(i.kind, crate::types::ImportKind::Static)));\n        assert!(analysis\n            .imports\n            .iter()\n            .any(|i| i.source == \"./side.css\" && matches!(i.kind, crate::types::ImportKind::SideEffect)));\n        assert!(analysis\n            .reexports\n            .iter()\n            .any(|r| r.source == \"./reexports\"));\n        assert!(analysis\n            .reexports\n            .iter()\n            .any(|r| r.source == \"./star\"));\n        assert!(analysis\n            .dynamic_imports\n            .iter()\n            .any(|s| s == \"./lazy\"));\n\n        let commands: Vec<_> = analysis.command_calls.iter().map(|c| c.name.clone()).collect();\n        assert!(commands.contains(&\"cmd_safe\".to_string()));\n        assert!(commands.contains(&\"cmd_snake\".to_string()));\n        assert!(commands.contains(&\"cmd_invoke\".to_string()));\n\n        // exports should include defaults and named\n        let export_names: Vec<_> = analysis.exports.iter().map(|e| e.name.clone()).collect();\n        assert!(export_names.contains(&\"localValue\".to_string()));\n        assert!(export_names.contains(&\"MyComp\".to_string()));\n        assert!(export_names.contains(&\"namedA\".to_string()));\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":1}},{"line":23,"address":[],"length":0,"stats":{"Line":2}},{"line":24,"address":[],"length":0,"stats":{"Line":2}},{"line":25,"address":[],"length":0,"stats":{"Line":5}},{"line":26,"address":[],"length":0,"stats":{"Line":18}},{"line":27,"address":[],"length":0,"stats":{"Line":6}},{"line":28,"address":[],"length":0,"stats":{"Line":2}},{"line":29,"address":[],"length":0,"stats":{"Line":2}},{"line":32,"address":[],"length":0,"stats":{"Line":4}},{"line":33,"address":[],"length":0,"stats":{"Line":9}},{"line":34,"address":[],"length":0,"stats":{"Line":3}},{"line":35,"address":[],"length":0,"stats":{"Line":1}},{"line":36,"address":[],"length":0,"stats":{"Line":1}},{"line":40,"address":[],"length":0,"stats":{"Line":4}},{"line":41,"address":[],"length":0,"stats":{"Line":3}},{"line":42,"address":[],"length":0,"stats":{"Line":6}},{"line":43,"address":[],"length":0,"stats":{"Line":3}},{"line":44,"address":[],"length":0,"stats":{"Line":3}},{"line":45,"address":[],"length":0,"stats":{"Line":1}},{"line":46,"address":[],"length":0,"stats":{"Line":1}},{"line":50,"address":[],"length":0,"stats":{"Line":4}},{"line":51,"address":[],"length":0,"stats":{"Line":3}},{"line":52,"address":[],"length":0,"stats":{"Line":6}},{"line":53,"address":[],"length":0,"stats":{"Line":3}},{"line":54,"address":[],"length":0,"stats":{"Line":3}},{"line":55,"address":[],"length":0,"stats":{"Line":1}},{"line":56,"address":[],"length":0,"stats":{"Line":1}},{"line":60,"address":[],"length":0,"stats":{"Line":4}},{"line":61,"address":[],"length":0,"stats":{"Line":3}},{"line":62,"address":[],"length":0,"stats":{"Line":6}},{"line":63,"address":[],"length":0,"stats":{"Line":3}},{"line":64,"address":[],"length":0,"stats":{"Line":3}},{"line":65,"address":[],"length":0,"stats":{"Line":1}},{"line":66,"address":[],"length":0,"stats":{"Line":1}},{"line":71,"address":[],"length":0,"stats":{"Line":2}},{"line":72,"address":[],"length":0,"stats":{"Line":4}},{"line":73,"address":[],"length":0,"stats":{"Line":9}},{"line":74,"address":[],"length":0,"stats":{"Line":6}},{"line":75,"address":[],"length":0,"stats":{"Line":3}},{"line":76,"address":[],"length":0,"stats":{"Line":2}},{"line":77,"address":[],"length":0,"stats":{"Line":1}},{"line":78,"address":[],"length":0,"stats":{"Line":1}},{"line":81,"address":[],"length":0,"stats":{"Line":4}},{"line":82,"address":[],"length":0,"stats":{"Line":8}},{"line":83,"address":[],"length":0,"stats":{"Line":9}},{"line":84,"address":[],"length":0,"stats":{"Line":3}},{"line":85,"address":[],"length":0,"stats":{"Line":6}},{"line":86,"address":[],"length":0,"stats":{"Line":3}},{"line":87,"address":[],"length":0,"stats":{"Line":2}},{"line":88,"address":[],"length":0,"stats":{"Line":1}},{"line":89,"address":[],"length":0,"stats":{"Line":1}},{"line":93,"address":[],"length":0,"stats":{"Line":2}},{"line":94,"address":[],"length":0,"stats":{"Line":4}},{"line":95,"address":[],"length":0,"stats":{"Line":9}},{"line":96,"address":[],"length":0,"stats":{"Line":3}},{"line":99,"address":[],"length":0,"stats":{"Line":2}},{"line":100,"address":[],"length":0,"stats":{"Line":4}},{"line":101,"address":[],"length":0,"stats":{"Line":9}},{"line":102,"address":[],"length":0,"stats":{"Line":2}},{"line":103,"address":[],"length":0,"stats":{"Line":3}},{"line":104,"address":[],"length":0,"stats":{"Line":2}},{"line":105,"address":[],"length":0,"stats":{"Line":1}},{"line":109,"address":[],"length":0,"stats":{"Line":4}},{"line":110,"address":[],"length":0,"stats":{"Line":2}},{"line":112,"address":[],"length":0,"stats":{"Line":3}},{"line":113,"address":[],"length":0,"stats":{"Line":1}},{"line":114,"address":[],"length":0,"stats":{"Line":3}},{"line":115,"address":[],"length":0,"stats":{"Line":2}},{"line":116,"address":[],"length":0,"stats":{"Line":1}},{"line":119,"address":[],"length":0,"stats":{"Line":5}},{"line":120,"address":[],"length":0,"stats":{"Line":16}},{"line":121,"address":[],"length":0,"stats":{"Line":10}},{"line":122,"address":[],"length":0,"stats":{"Line":9}},{"line":123,"address":[],"length":0,"stats":{"Line":6}},{"line":124,"address":[],"length":0,"stats":{"Line":3}},{"line":128,"address":[],"length":0,"stats":{"Line":5}},{"line":129,"address":[],"length":0,"stats":{"Line":3}},{"line":130,"address":[],"length":0,"stats":{"Line":4}},{"line":131,"address":[],"length":0,"stats":{"Line":3}},{"line":132,"address":[],"length":0,"stats":{"Line":3}},{"line":133,"address":[],"length":0,"stats":{"Line":1}},{"line":147,"address":[],"length":0,"stats":{"Line":1}}],"covered":82,"coverable":82},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","mod.rs"],"content":"pub mod assets;\nmod css;\npub mod html;\npub mod js;\npub mod open_server;\npub mod py;\npub mod regexes;\npub mod report;\npub mod resolvers;\npub mod runner;\npub mod rust;\n\npub(super) fn brace_list_to_names(raw: &str) -> Vec<String> {\n    raw.split(',')\n        .filter_map(|item| {\n            let trimmed = item.trim();\n            if trimmed.is_empty() {\n                return None;\n            }\n            if let Some((_, alias)) = trimmed.split_once(\" as \") {\n                Some(alias.trim().to_string())\n            } else {\n                Some(trimmed.to_string())\n            }\n        })\n        .collect()\n}\n\npub(super) fn offset_to_line(content: &str, offset: usize) -> usize {\n    content[..offset].bytes().filter(|b| *b == b'\\n').count() + 1\n}\n\npub use report::{AiInsight, CommandGap, GraphData, GraphNode, RankedDup, ReportSection};\npub use runner::run_import_analyzer;\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":3}},{"line":14,"address":[],"length":0,"stats":{"Line":6}},{"line":15,"address":[],"length":0,"stats":{"Line":7}},{"line":16,"address":[],"length":0,"stats":{"Line":12}},{"line":17,"address":[],"length":0,"stats":{"Line":8}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":5}},{"line":21,"address":[],"length":0,"stats":{"Line":1}},{"line":23,"address":[],"length":0,"stats":{"Line":3}},{"line":29,"address":[],"length":0,"stats":{"Line":5}},{"line":30,"address":[],"length":0,"stats":{"Line":1535}}],"covered":10,"coverable":11},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","open_server.rs"],"content":"use std::io::{self, BufRead, Write};\nuse std::net::{TcpListener, TcpStream};\nuse std::path::{Path, PathBuf};\nuse std::process::Command;\nuse std::sync::OnceLock;\nuse std::thread;\n\nstatic OPEN_SERVER_BASE: OnceLock<String> = OnceLock::new();\n\npub(crate) fn url_encode_component(input: &str) -> String {\n    input\n        .bytes()\n        .map(|b| match b {\n            b'A'..=b'Z' | b'a'..=b'z' | b'0'..=b'9' | b'-' | b'_' | b'.' | b'~' => {\n                (b as char).to_string()\n            }\n            _ => format!(\"%{:02X}\", b),\n        })\n        .collect()\n}\n\npub(crate) fn url_decode_component(input: &str) -> Option<String> {\n    let mut out = String::new();\n    let mut iter = input.as_bytes().iter().cloned();\n    while let Some(b) = iter.next() {\n        if b == b'%' {\n            let hi = iter.next()?;\n            let lo = iter.next()?;\n            let hex = [hi, lo];\n            let s = std::str::from_utf8(&hex).ok()?;\n            let v = u8::from_str_radix(s, 16).ok()?;\n            out.push(v as char);\n        } else {\n            out.push(b as char);\n        }\n    }\n    Some(out)\n}\n\npub(crate) fn open_in_browser(path: &Path) {\n    let Ok(canon) = path.canonicalize() else {\n        eprintln!(\n            \"[loctree][warn] Could not resolve report path for auto-open: {}\",\n            path.display()\n        );\n        return;\n    };\n\n    let target = canon.to_string_lossy().to_string();\n    if target.bytes().any(|b| b < 0x20) {\n        eprintln!(\n            \"[loctree][warn] Skipping auto-open for suspicious path: {}\",\n            target\n        );\n        return;\n    }\n\n    #[cfg(target_os = \"macos\")]\n    let try_cmds = vec![(\"open\", vec![target.as_str()])];\n    #[cfg(target_os = \"windows\")]\n    let try_cmds = vec![(\n        \"powershell\",\n        vec![\n            \"-NoProfile\",\n            \"-Command\",\n            \"Start-Process\",\n            \"-FilePath\",\n            target.as_str(),\n        ],\n    )];\n    #[cfg(all(not(target_os = \"macos\"), not(target_os = \"windows\")))]\n    let try_cmds = vec![(\"xdg-open\", vec![target.as_str()])];\n\n    for (program, args) in try_cmds {\n        if Command::new(program).args(args.clone()).spawn().is_ok() {\n            return;\n        }\n    }\n    eprintln!(\n        \"[loctree][warn] Could not open report automatically: {}\",\n        target\n    );\n}\n\npub(crate) fn start_open_server(\n    roots: Vec<PathBuf>,\n    editor_cmd: Option<String>,\n) -> Option<(String, thread::JoinHandle<()>)> {\n    let listener = TcpListener::bind(\"127.0.0.1:0\").ok()?;\n    let port = listener.local_addr().ok()?.port();\n    let base = format!(\"http://127.0.0.1:{port}\");\n    let _ = OPEN_SERVER_BASE.set(base.clone());\n\n    let handle = thread::spawn(move || {\n        for mut stream in listener.incoming().flatten() {\n            let mut buf = String::new();\n            let mut reader = io::BufReader::new(&stream);\n            if reader.read_line(&mut buf).is_ok() {\n                handle_open_request(&mut stream, &roots, editor_cmd.as_ref(), buf.trim());\n            }\n        }\n    });\n    Some((base, handle))\n}\n\npub(crate) fn current_open_base() -> Option<String> {\n    OPEN_SERVER_BASE.get().cloned()\n}\n\nfn open_file_in_editor(\n    full_path: &Path,\n    line: usize,\n    editor_cmd: Option<&String>,\n) -> io::Result<()> {\n    if let Some(tpl) = editor_cmd {\n        let replaced = tpl\n            .replace(\"{file}\", full_path.to_string_lossy().as_ref())\n            .replace(\"{line}\", &line.to_string());\n        let parts: Vec<String> = replaced.split_whitespace().map(|s| s.to_string()).collect();\n        if let Some((prog, args)) = parts.split_first() {\n            let status = Command::new(prog).args(args).status()?;\n            if status.success() {\n                return Ok(());\n            }\n        }\n    } else if Command::new(\"code\")\n        .arg(\"-g\")\n        .arg(format!(\"{}:{}\", full_path.to_string_lossy(), line.max(1)))\n        .status()\n        .map(|s| s.success())\n        .unwrap_or(false)\n    {\n        return Ok(());\n    }\n\n    #[cfg(target_os = \"macos\")]\n    let fallback = Command::new(\"open\")\n        .arg(full_path)\n        .status()\n        .map(|s| s.success())\n        .unwrap_or(false);\n    #[cfg(target_os = \"windows\")]\n    let fallback = Command::new(\"cmd\")\n        .args([\"/C\", \"start\", full_path.to_string_lossy().as_ref()])\n        .status()\n        .map(|s| s.success())\n        .unwrap_or(false);\n    #[cfg(all(not(target_os = \"macos\"), not(target_os = \"windows\")))]\n    let fallback = Command::new(\"xdg-open\")\n        .arg(full_path)\n        .status()\n        .map(|s| s.success())\n        .unwrap_or(false);\n\n    if fallback {\n        Ok(())\n    } else {\n        Err(io::Error::other(\"could not open file via editor\"))\n    }\n}\n\nfn handle_open_request(\n    stream: &mut TcpStream,\n    roots: &[PathBuf],\n    editor_cmd: Option<&String>,\n    request_line: &str,\n) {\n    let mut parts = request_line.split_whitespace();\n    let _method = parts.next();\n    let target = parts.next().unwrap_or(\"/\");\n    if !target.starts_with(\"/open?\") {\n        let _ = stream.write_all(b\"HTTP/1.1 404 Not Found\\r\\n\\r\\n\");\n        return;\n    }\n    let query = &target[6..];\n    let mut file = None;\n    let mut line = 1usize;\n    for pair in query.split('&') {\n        if let Some((k, v)) = pair.split_once('=') {\n            match k {\n                \"f\" => file = url_decode_component(v),\n                \"l\" => {\n                    line = v.parse::<usize>().unwrap_or(1).max(1);\n                }\n                _ => {}\n            }\n        }\n    }\n    let Some(rel_or_abs) = file else {\n        let _ = stream.write_all(b\"HTTP/1.1 400 Bad Request\\r\\n\\r\\n\");\n        return;\n    };\n\n    let mut candidate = None;\n    let path_obj = PathBuf::from(&rel_or_abs);\n    if path_obj.is_absolute() {\n        if let Ok(canon) = path_obj.canonicalize() {\n            if roots.iter().any(|r| canon.starts_with(r)) {\n                candidate = Some(canon);\n            }\n        }\n    } else {\n        for root in roots {\n            let joined = root.join(&path_obj);\n            if let Ok(canon) = joined.canonicalize() {\n                if canon.starts_with(root) {\n                    candidate = Some(canon);\n                    break;\n                }\n            }\n        }\n    }\n\n    let Some(full) = candidate else {\n        let _ = stream.write_all(b\"HTTP/1.1 404 Not Found\\r\\n\\r\\n\");\n        return;\n    };\n\n    let status = open_file_in_editor(&full, line, editor_cmd);\n    let response = if status.is_ok() {\n        \"HTTP/1.1 200 OK\\r\\n\\r\\nopened\"\n    } else {\n        \"HTTP/1.1 500 Internal Server Error\\r\\n\\r\\nopen failed\"\n    };\n    let _ = stream.write_all(response.as_bytes());\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":110},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","py.rs"],"content":"use std::collections::HashSet;\nuse std::path::Path;\n\nuse crate::types::{\n    ExportSymbol, FileAnalysis, ImportEntry, ImportKind, ReexportEntry, ReexportKind,\n};\n\nuse super::regexes::{\n    regex_py_all, regex_py_class, regex_py_def, regex_py_dynamic_dunder, regex_py_dynamic_importlib,\n};\nuse super::resolvers::resolve_python_relative;\n\npub(crate) fn analyze_py_file(\n    content: &str,\n    path: &Path,\n    root: &Path,\n    extensions: Option<&HashSet<String>>,\n    relative: String,\n) -> FileAnalysis {\n    let mut imports = Vec::new();\n    let mut reexports = Vec::new();\n    let mut dynamic_imports = Vec::new();\n    let mut exports = Vec::new();\n\n    for line in content.lines() {\n        let without_comment = line.split('#').next().unwrap_or(\"\").trim_end();\n        let trimmed = without_comment.trim_start();\n        if let Some(rest) = trimmed.strip_prefix(\"import \") {\n            for part in rest.split(',') {\n                let mut name = part.trim();\n                if let Some((lhs, _)) = name.split_once(\" as \") {\n                    name = lhs.trim();\n                }\n                if !name.is_empty() {\n                    imports.push(ImportEntry {\n                        source: name.to_string(),\n                        kind: ImportKind::Static,\n                    });\n                }\n            }\n        } else if let Some(rest) = trimmed.strip_prefix(\"from \") {\n            if let Some((module, names_raw)) = rest.split_once(\" import \") {\n                let module = module.trim().trim_end_matches('.');\n                let names_clean = names_raw.trim().trim_matches('(').trim_matches(')');\n                let names_clean = names_clean.split('#').next().unwrap_or(\"\").trim();\n                if !module.is_empty() {\n                    imports.push(ImportEntry {\n                        source: module.to_string(),\n                        kind: ImportKind::Static,\n                    });\n                }\n                if names_clean == \"*\" {\n                    let resolved = resolve_python_relative(module, path, root, extensions);\n                    reexports.push(ReexportEntry {\n                        source: module.to_string(),\n                        kind: ReexportKind::Star,\n                        resolved,\n                    });\n                }\n            }\n        }\n    }\n\n    for caps in regex_py_dynamic_importlib().captures_iter(content) {\n        if let Some(m) = caps.get(1) {\n            dynamic_imports.push(m.as_str().to_string());\n        }\n    }\n    for caps in regex_py_dynamic_dunder().captures_iter(content) {\n        if let Some(m) = caps.get(1) {\n            dynamic_imports.push(m.as_str().to_string());\n        }\n    }\n\n    for caps in regex_py_all().captures_iter(content) {\n        let body = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\");\n        for item in body.split(',') {\n            let trimmed = item.trim();\n            let name = trimmed\n                .trim_matches(|c| c == '\\'' || c == '\"')\n                .trim()\n                .to_string();\n            if !name.is_empty() {\n                exports.push(ExportSymbol {\n                    name,\n                    kind: \"__all__\".to_string(),\n                });\n            }\n        }\n    }\n\n    for caps in regex_py_def().captures_iter(content) {\n        if let Some(name) = caps.get(1) {\n            let n = name.as_str();\n            if !n.starts_with('_') {\n                exports.push(ExportSymbol {\n                    name: n.to_string(),\n                    kind: \"def\".to_string(),\n                });\n            }\n        }\n    }\n    for caps in regex_py_class().captures_iter(content) {\n        if let Some(name) = caps.get(1) {\n            let n = name.as_str();\n            if !n.starts_with('_') {\n                exports.push(ExportSymbol {\n                    name: n.to_string(),\n                    kind: \"class\".to_string(),\n                });\n            }\n        }\n    }\n\n    FileAnalysis {\n        path: relative,\n        loc: 0,\n        imports,\n        reexports,\n        dynamic_imports,\n        exports,\n        command_calls: Vec::new(),\n        command_handlers: Vec::new(),\n    }\n}\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":64},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","regexes.rs"],"content":"use std::sync::OnceLock;\n\nuse regex::Regex;\n\npub(crate) fn regex_import() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*import\\s+([^;]+?)\\s+from\\s+[\"']([^\"']+)[\"']\"#).unwrap())\n}\n\npub(crate) fn regex_side_effect_import() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*import\\s+[\"']([^\"']+)[\"']\"#).unwrap())\n}\n\npub(crate) fn regex_reexport_star() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*export\\s+\\*\\s+from\\s+[\"']([^\"']+)[\"']\"#).unwrap())\n}\n\npub(crate) fn regex_reexport_named() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| {\n        Regex::new(r#\"(?m)^\\s*export\\s+\\{([^}]+)\\}\\s+from\\s+[\"']([^\"']+)[\"']\"#).unwrap()\n    })\n}\n\npub(crate) fn regex_dynamic_import() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"import\\s*\\(\\s*[\"']([^\"']+)[\"']\\s*\\)\"#).unwrap())\n}\n\npub(crate) fn regex_export_named_decl() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| {\n        Regex::new(\n            r#\"(?m)^\\s*export\\s+(?:async\\s+)?(?:function|const|let|var|class|interface|type|enum)\\s+([A-Za-z0-9_.$]+)\"#,\n        )\n        .unwrap()\n    })\n}\n\npub(crate) fn regex_export_default() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*export\\s+default(?:\\s+(?:async\\s+)?(?:function|class)\\s+([A-Za-z0-9_.$]+))?\"#).unwrap())\n}\n\npub(crate) fn regex_export_brace() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*export\\s+\\{([^}]+)\\}\\s*;?\"#).unwrap())\n}\n\npub(crate) fn regex_safe_invoke() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"safeInvoke\\(\\s*[\"']([^\"']+)[\"']\"#).unwrap())\n}\n\npub(crate) fn regex_invoke_snake() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"invokeSnake\\(\\s*[\"']([^\"']+)[\"']\"#).unwrap())\n}\n\npub(crate) fn regex_tauri_command_fn() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| {\n        Regex::new(r#\"(?m)#\\s*\\[\\s*tauri::command([^\\]]*)\\]\\s*(?:pub\\s*(?:\\([^)]*\\)\\s*)?)?(?:async\\s+)?fn\\s+([A-Za-z0-9_]+)\"#)\n            .unwrap()\n    })\n}\n\npub(crate) fn regex_tauri_invoke() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| {\n        // Matches top-level invoke(\"cmd\") calls (avoids foo.invoke())\n        Regex::new(r#\"(?m)(?:^|[^A-Za-z0-9_\\.])invoke\\(\\s*[\\\"']([^\\\"']+)[\\\"']\"#)\n            .unwrap()\n    })\n}\n\npub(crate) fn regex_css_import() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| {\n        // @import \"x.css\";  @import url(\"x.css\"); @import url(x.css);\n        Regex::new(r#\"(?m)@import\\s+(?:url\\()?['\"]?([^\"'()\\s]+)['\"]?\\)?\"#).unwrap()\n    })\n}\n\npub(crate) fn regex_rust_use() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*(?:pub\\s*(?:\\([^)]*\\))?\\s+)?use\\s+([^;]+);\"#).unwrap())\n}\n\npub(crate) fn regex_rust_pub_use() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*pub\\s*(?:\\([^)]*\\))?\\s+use\\s+([^;]+);\"#).unwrap())\n}\n\npub(crate) fn regex_rust_pub_item(kind: &str) -> Regex {\n    // Matches visibility modifiers like pub(crate) and optional async for fn\n    let pattern = format!(\n        r#\"(?m)^\\s*pub\\s*(?:\\([^)]*\\)\\s*)?(?:async\\s+)?{}\\s+([A-Za-z0-9_]+)\"#,\n        kind\n    );\n    Regex::new(&pattern).unwrap()\n}\n\npub(crate) fn regex_rust_pub_const_like(kind: &str) -> Regex {\n    let pattern = format!(\n        r#\"(?m)^\\s*pub\\s*(?:\\([^)]*\\)\\s*)?{}\\s+([A-Za-z0-9_]+)\"#,\n        kind\n    );\n    Regex::new(&pattern).unwrap()\n}\n\npub(crate) fn rust_pub_decl_regexes() -> &'static [Regex] {\n    static RE: OnceLock<Vec<Regex>> = OnceLock::new();\n    RE.get_or_init(|| {\n        vec![\n            regex_rust_pub_item(\"fn\"),\n            regex_rust_pub_item(\"struct\"),\n            regex_rust_pub_item(\"enum\"),\n            regex_rust_pub_item(\"trait\"),\n            regex_rust_pub_item(\"type\"),\n            regex_rust_pub_item(\"union\"),\n            regex_rust_pub_item(\"mod\"),\n        ]\n    })\n    .as_slice()\n}\n\npub(crate) fn rust_pub_const_regexes() -> &'static [Regex] {\n    static RE: OnceLock<Vec<Regex>> = OnceLock::new();\n    RE.get_or_init(|| {\n        vec![\n            regex_rust_pub_const_like(\"const\"),\n            regex_rust_pub_const_like(\"static\"),\n        ]\n    })\n    .as_slice()\n}\n\npub(crate) fn regex_py_dynamic_importlib() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"importlib\\.import_module\\(\\s*[\"']([^\"']+)[\"']\"#).unwrap())\n}\n\npub(crate) fn regex_py_dynamic_dunder() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"__import__\\(\\s*[\"']([^\"']+)[\"']\"#).unwrap())\n}\n\npub(crate) fn regex_py_all() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?s)__all__\\s*=\\s*\\[([^\\]]*)\\]\"#).unwrap())\n}\n\npub(crate) fn regex_py_def() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*def\\s+([A-Za-z_][A-Za-z0-9_]*)\"#).unwrap())\n}\n\npub(crate) fn regex_py_class() -> &'static Regex {\n    static RE: OnceLock<Regex> = OnceLock::new();\n    RE.get_or_init(|| Regex::new(r#\"(?m)^\\s*class\\s+([A-Za-z_][A-Za-z0-9_]*)\"#).unwrap())\n}\n","traces":[{"line":5,"address":[],"length":0,"stats":{"Line":1}},{"line":7,"address":[],"length":0,"stats":{"Line":5}},{"line":10,"address":[],"length":0,"stats":{"Line":1}},{"line":12,"address":[],"length":0,"stats":{"Line":5}},{"line":15,"address":[],"length":0,"stats":{"Line":1}},{"line":17,"address":[],"length":0,"stats":{"Line":5}},{"line":20,"address":[],"length":0,"stats":{"Line":1}},{"line":22,"address":[],"length":0,"stats":{"Line":3}},{"line":23,"address":[],"length":0,"stats":{"Line":3}},{"line":27,"address":[],"length":0,"stats":{"Line":1}},{"line":29,"address":[],"length":0,"stats":{"Line":5}},{"line":32,"address":[],"length":0,"stats":{"Line":1}},{"line":34,"address":[],"length":0,"stats":{"Line":3}},{"line":35,"address":[],"length":0,"stats":{"Line":1}},{"line":36,"address":[],"length":0,"stats":{"Line":1}},{"line":38,"address":[],"length":0,"stats":{"Line":1}},{"line":42,"address":[],"length":0,"stats":{"Line":1}},{"line":44,"address":[],"length":0,"stats":{"Line":5}},{"line":47,"address":[],"length":0,"stats":{"Line":1}},{"line":49,"address":[],"length":0,"stats":{"Line":5}},{"line":52,"address":[],"length":0,"stats":{"Line":1}},{"line":54,"address":[],"length":0,"stats":{"Line":5}},{"line":57,"address":[],"length":0,"stats":{"Line":1}},{"line":59,"address":[],"length":0,"stats":{"Line":5}},{"line":62,"address":[],"length":0,"stats":{"Line":1}},{"line":64,"address":[],"length":0,"stats":{"Line":3}},{"line":65,"address":[],"length":0,"stats":{"Line":2}},{"line":66,"address":[],"length":0,"stats":{"Line":1}},{"line":70,"address":[],"length":0,"stats":{"Line":1}},{"line":72,"address":[],"length":0,"stats":{"Line":3}},{"line":74,"address":[],"length":0,"stats":{"Line":2}},{"line":75,"address":[],"length":0,"stats":{"Line":1}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":1}},{"line":89,"address":[],"length":0,"stats":{"Line":5}},{"line":92,"address":[],"length":0,"stats":{"Line":1}},{"line":94,"address":[],"length":0,"stats":{"Line":5}},{"line":97,"address":[],"length":0,"stats":{"Line":7}},{"line":99,"address":[],"length":0,"stats":{"Line":14}},{"line":103,"address":[],"length":0,"stats":{"Line":21}},{"line":106,"address":[],"length":0,"stats":{"Line":2}},{"line":107,"address":[],"length":0,"stats":{"Line":4}},{"line":111,"address":[],"length":0,"stats":{"Line":6}},{"line":114,"address":[],"length":0,"stats":{"Line":1}},{"line":116,"address":[],"length":0,"stats":{"Line":3}},{"line":117,"address":[],"length":0,"stats":{"Line":1}},{"line":118,"address":[],"length":0,"stats":{"Line":2}},{"line":119,"address":[],"length":0,"stats":{"Line":2}},{"line":120,"address":[],"length":0,"stats":{"Line":2}},{"line":121,"address":[],"length":0,"stats":{"Line":2}},{"line":122,"address":[],"length":0,"stats":{"Line":2}},{"line":123,"address":[],"length":0,"stats":{"Line":2}},{"line":124,"address":[],"length":0,"stats":{"Line":2}},{"line":130,"address":[],"length":0,"stats":{"Line":1}},{"line":132,"address":[],"length":0,"stats":{"Line":3}},{"line":133,"address":[],"length":0,"stats":{"Line":1}},{"line":134,"address":[],"length":0,"stats":{"Line":2}},{"line":135,"address":[],"length":0,"stats":{"Line":2}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}}],"covered":57,"coverable":70},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","report.rs"],"content":"use serde::Serialize;\n\n#[derive(Clone)]\npub struct CommandGap {\n    pub name: String,\n    pub implementation_name: Option<String>,\n    pub locations: Vec<(String, usize)>,\n}\n\n#[derive(Clone)]\npub struct AiInsight {\n    pub title: String,\n    pub severity: String,\n    pub message: String,\n}\n\n#[derive(Clone, Serialize)]\npub struct GraphNode {\n    pub id: String,\n    pub label: String,\n    pub loc: usize,\n    pub x: f32,\n    pub y: f32,\n}\n\n#[derive(Clone, Serialize)]\npub struct GraphData {\n    pub nodes: Vec<GraphNode>,\n    pub edges: Vec<(String, String, String)>, // from, to, kind\n}\n\n#[derive(Clone)]\npub struct RankedDup {\n    pub name: String,\n    pub files: Vec<String>,\n    pub score: usize,\n    pub prod_count: usize,\n    pub dev_count: usize,\n    pub canonical: String,\n    pub refactors: Vec<String>,\n}\n\npub struct ReportSection {\n    pub root: String,\n    pub files_analyzed: usize,\n    pub ranked_dups: Vec<RankedDup>,\n    pub cascades: Vec<(String, String)>,\n    pub dynamic: Vec<(String, Vec<String>)>,\n    pub analyze_limit: usize,\n    pub missing_handlers: Vec<CommandGap>,\n    pub unused_handlers: Vec<CommandGap>,\n    pub command_counts: (usize, usize),\n    pub open_base: Option<String>,\n    pub graph: Option<GraphData>,\n    pub insights: Vec<AiInsight>,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","resolvers.rs"],"content":"use std::collections::HashSet;\nuse std::path::{Path, PathBuf};\n\npub(crate) fn resolve_reexport_target(\n    file_path: &Path,\n    root: &Path,\n    spec: &str,\n    exts: Option<&HashSet<String>>,\n) -> Option<String> {\n    if !spec.starts_with('.') {\n        return None;\n    }\n    let parent = file_path.parent()?;\n    let candidate = parent.join(spec);\n    if candidate.is_dir() {\n        return None;\n    }\n    resolve_with_extensions(candidate, root, exts)\n}\n\npub(crate) fn resolve_python_relative(\n    module: &str,\n    file_path: &Path,\n    root: &Path,\n    exts: Option<&HashSet<String>>,\n) -> Option<String> {\n    if !module.starts_with('.') {\n        return None;\n    }\n\n    let mut leading = 0usize;\n    for ch in module.chars() {\n        if ch == '.' {\n            leading += 1;\n        } else {\n            break;\n        }\n    }\n\n    let mut base = file_path.parent()?;\n    for _ in 1..leading {\n        base = base.parent()?;\n    }\n\n    let remainder = module.trim_start_matches('.').replace('.', \"/\");\n    let joined = if remainder.is_empty() {\n        base.to_path_buf()\n    } else {\n        base.join(remainder)\n    };\n\n    if joined.is_dir() {\n        return None;\n    }\n\n    resolve_with_extensions(joined, root, exts)\n}\n\npub(crate) fn resolve_js_relative(\n    file_path: &Path,\n    root: &Path,\n    spec: &str,\n    exts: Option<&HashSet<String>>,\n) -> Option<String> {\n    if !spec.starts_with('.') {\n        return None;\n    }\n    let parent = file_path.parent()?;\n    let candidate = parent.join(spec);\n    resolve_with_extensions(candidate, root, exts)\n}\n\nfn resolve_with_extensions(\n    candidate: PathBuf,\n    root: &Path,\n    exts: Option<&HashSet<String>>,\n) -> Option<String> {\n    if candidate.extension().is_none() {\n        if let Some(set) = exts {\n            for ext in set {\n                let with_ext = candidate.with_extension(ext);\n                if with_ext.exists() {\n                    return canonical_rel(&with_ext, root).or_else(|| canonical_abs(&with_ext));\n                }\n            }\n        }\n    }\n\n    if candidate.exists() {\n        canonical_rel(&candidate, root).or_else(|| canonical_abs(&candidate))\n    } else {\n        None\n    }\n}\n\nfn canonical_rel(path: &Path, root: &Path) -> Option<String> {\n    path.canonicalize().ok().and_then(|p| {\n        p.strip_prefix(root)\n            .ok()\n            .map(|q| q.to_string_lossy().to_string())\n    })\n}\n\nfn canonical_abs(path: &Path) -> Option<String> {\n    path.canonicalize()\n        .ok()\n        .map(|p| p.to_string_lossy().to_string())\n}\n","traces":[{"line":4,"address":[],"length":0,"stats":{"Line":2}},{"line":10,"address":[],"length":0,"stats":{"Line":2}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":6}},{"line":14,"address":[],"length":0,"stats":{"Line":8}},{"line":15,"address":[],"length":0,"stats":{"Line":2}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":8}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":2}},{"line":78,"address":[],"length":0,"stats":{"Line":4}},{"line":79,"address":[],"length":0,"stats":{"Line":4}},{"line":80,"address":[],"length":0,"stats":{"Line":10}},{"line":81,"address":[],"length":0,"stats":{"Line":12}},{"line":82,"address":[],"length":0,"stats":{"Line":4}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":2}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":2}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}}],"covered":14,"coverable":50},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","runner.rs"],"content":"use std::collections::{HashMap, HashSet};\nuse std::fs;\nuse std::io;\nuse std::path::{Path, PathBuf};\n\nuse serde_json::json;\n\nuse crate::args::{preset_ignore_symbols, ParsedArgs};\nuse crate::fs_utils::{gather_files, normalise_ignore_patterns, GitIgnoreChecker};\nuse crate::types::{ExportIndex, FileAnalysis, ImportKind, Options, OutputMode, ReexportKind};\n\nuse globset::{Glob, GlobSet, GlobSetBuilder};\n\nuse super::css::analyze_css_file;\nuse super::html::render_html_report;\nuse super::js::analyze_js_file;\nuse super::open_server::{current_open_base, open_in_browser, start_open_server};\nuse super::py::analyze_py_file;\nuse super::resolvers::{resolve_js_relative, resolve_python_relative};\nuse super::rust::analyze_rust_file;\nuse super::{AiInsight, CommandGap, GraphData, GraphNode, RankedDup, ReportSection};\n\nconst MAX_GRAPH_NODES: usize = 8000;\nconst MAX_GRAPH_EDGES: usize = 12000;\n\nfn normalize_cmd_name(name: &str) -> String {\n    let mut out = String::new();\n    let mut last_was_lower = false;\n    for ch in name.chars() {\n        if ch.is_ascii_alphanumeric() {\n            if ch.is_uppercase() && last_was_lower && !out.is_empty() {\n                out.push('_');\n            }\n            out.push(ch.to_ascii_lowercase());\n            last_was_lower = ch.is_ascii_lowercase();\n        } else if !out.ends_with('_') && !out.is_empty() {\n            out.push('_');\n            last_was_lower = false;\n        }\n    }\n    while out.ends_with('_') {\n        out.pop();\n    }\n    if out.is_empty() {\n        name.to_lowercase()\n    } else {\n        out\n    }\n}\n\nfn is_dev_file(path: &str) -> bool {\n    path.contains(\"__tests__\")\n        || path.contains(\"stories\")\n        || path.contains(\".stories.\")\n        || path.contains(\"story.\")\n}\n\nfn layout_positions(\n    nodes: &[String],\n    edges: &[(String, String, String)],\n) -> HashMap<String, (f32, f32)> {\n    let mut adj: HashMap<String, Vec<String>> = HashMap::new();\n    for n in nodes {\n        adj.entry(n.clone()).or_default();\n    }\n    for (a, b, _) in edges {\n        adj.entry(a.clone()).or_default().push(b.clone());\n        adj.entry(b.clone()).or_default().push(a.clone());\n    }\n\n    let mut visited: HashSet<String> = HashSet::new();\n    let mut comps: Vec<Vec<String>> = Vec::new();\n    for n in nodes {\n        if visited.contains(n) {\n            continue;\n        }\n        let mut stack = vec![n.clone()];\n        let mut comp = Vec::new();\n        visited.insert(n.clone());\n        while let Some(cur) = stack.pop() {\n            comp.push(cur.clone());\n            if let Some(neigh) = adj.get(&cur) {\n                for nb in neigh {\n                    if visited.insert(nb.clone()) {\n                        stack.push(nb.clone());\n                    }\n                }\n            }\n        }\n        comps.push(comp);\n    }\n\n    let cols = (comps.len() as f32).sqrt().ceil() as usize + 1;\n    let spacing = 1200f32;\n    let mut positions: HashMap<String, (f32, f32)> = HashMap::new();\n    for (idx, comp) in comps.iter().enumerate() {\n        let row = idx / cols;\n        let col = idx % cols;\n        let cx = (col as f32) * spacing;\n        let cy = (row as f32) * spacing;\n        let n = comp.len().max(1) as f32;\n        let radius = 160.0 + 30.0 * n.sqrt();\n        for (i, node) in comp.iter().enumerate() {\n            let theta = (i as f32) * (std::f32::consts::TAU / n);\n            let jitter = 12.0 * (i as f32 % 3.0) - 12.0;\n            let x = cx + radius * theta.cos() + jitter;\n            let y = cy + radius * theta.sin() - jitter;\n            positions.insert(node.clone(), (x, y));\n        }\n    }\n    positions\n}\n\nfn build_globset(patterns: &[String]) -> Option<GlobSet> {\n    let mut builder = GlobSetBuilder::new();\n    let mut added = false;\n    for pat in patterns {\n        if pat.trim().is_empty() {\n            continue;\n        }\n        match Glob::new(pat) {\n            Ok(glob) => {\n                builder.add(glob);\n                added = true;\n            }\n            Err(err) => eprintln!(\"[loctree][warn] invalid glob '{}': {}\", pat, err),\n        }\n    }\n    if !added {\n        None\n    } else {\n        builder.build().ok()\n    }\n}\n\nfn strip_excluded_paths(\n    paths: &[(String, usize, String)],\n    focus: &Option<GlobSet>,\n    exclude: &Option<GlobSet>,\n) -> Vec<(String, usize)> {\n    paths\n        .iter()\n        .filter_map(|(p, line, _)| {\n            let pb = Path::new(p);\n            if let Some(ex) = exclude {\n                if ex.is_match(pb) {\n                    return None;\n                }\n            }\n            if let Some(focus_globs) = focus {\n                if !focus_globs.is_match(pb) {\n                    return None;\n                }\n            }\n            Some((p.clone(), *line))\n        })\n        .collect()\n}\n\nfn opt_globset(globs: &[String]) -> Option<GlobSet> {\n    build_globset(globs).and_then(|g| if g.is_empty() { None } else { Some(g) })\n}\n\nfn strip_excluded(files: &[String], exclude: &Option<GlobSet>) -> Vec<String> {\n    match exclude {\n        None => files.to_vec(),\n        Some(set) => files.iter().filter(|p| !set.is_match(p)).cloned().collect(),\n    }\n}\n\nfn matches_focus(files: &[String], focus: &Option<GlobSet>) -> bool {\n    match focus {\n        None => true,\n        Some(set) => files.iter().any(|p| set.is_match(p)),\n    }\n}\n\nfn analyze_file(\n    path: &Path,\n    root: &Path,\n    extensions: Option<&HashSet<String>>,\n) -> io::Result<FileAnalysis> {\n    let content = std::fs::read_to_string(path)?;\n    let relative = path\n        .strip_prefix(root)\n        .unwrap_or(path)\n        .to_string_lossy()\n        .to_string();\n    let loc = content.lines().count();\n    let ext = path\n        .extension()\n        .and_then(|e| e.to_str())\n        .map(|s| s.to_lowercase())\n        .unwrap_or_default();\n\n    let mut analysis = match ext.as_str() {\n        \"rs\" => analyze_rust_file(&content, relative),\n        \"css\" => analyze_css_file(&content, relative),\n        \"py\" => analyze_py_file(&content, path, root, extensions, relative),\n        _ => analyze_js_file(&content, path, root, extensions, relative),\n    };\n    analysis.loc = loc;\n\n    Ok(analysis)\n}\n\npub fn default_analyzer_exts() -> HashSet<String> {\n    [\"ts\", \"tsx\", \"js\", \"jsx\", \"mjs\", \"cjs\", \"rs\", \"css\", \"py\"]\n        .iter()\n        .map(|s| s.to_string())\n        .collect()\n}\n\nfn collect_ai_insights(\n    files: &[FileAnalysis],\n    dups: &[RankedDup],\n    cascades: &[(String, String)],\n    gap_missing: &[CommandGap],\n    _gap_unused: &[CommandGap],\n) -> Vec<AiInsight> {\n    let mut insights = Vec::new();\n\n    // 1. Huge files\n    let huge_files: Vec<_> = files.iter().filter(|f| f.loc > 2000).collect();\n    if !huge_files.is_empty() {\n        insights.push(AiInsight {\n            title: \"Huge files detected\".to_string(),\n            severity: \"medium\".to_string(),\n            message: format!(\n                \"Found {} files with > 2000 LOC (e.g. {}). Consider splitting them.\",\n                huge_files.len(),\n                huge_files[0].path\n            ),\n        });\n    }\n\n    // 2. Many duplicates\n    if dups.len() > 10 {\n        insights.push(AiInsight {\n            title: \"High number of duplicate exports\".to_string(),\n            severity: \"medium\".to_string(),\n            message: format!(\n                \"Found {} duplicate export groups. Consider refactoring.\",\n                dups.len()\n            ),\n        });\n    }\n\n    // 3. Cascades\n    if cascades.len() > 20 {\n        insights.push(AiInsight {\n            title: \"Many re-export chains\".to_string(),\n            severity: \"low\".to_string(),\n            message: format!(\n                \"Found {} re-export cascades. This might affect tree-shaking/bundling.\",\n                cascades.len()\n            ),\n        });\n    }\n\n    // 4. Missing handlers\n    if !gap_missing.is_empty() {\n        insights.push(AiInsight {\n            title: \"Missing Tauri Handlers\".to_string(),\n            severity: \"high\".to_string(),\n            message: format!(\n                \"Frontend calls {} commands that are missing in Backend.\",\n                gap_missing.len()\n            ),\n        });\n    }\n\n    insights\n}\n\npub fn run_import_analyzer(root_list: &[PathBuf], parsed: &ParsedArgs) -> io::Result<()> {\n    let mut json_results = Vec::new();\n    let mut report_sections: Vec<ReportSection> = Vec::new();\n    let mut server_handle = None;\n    let mut open_base = None;\n\n    let mut ignore_exact: HashSet<String> = HashSet::new();\n    let mut ignore_prefixes: Vec<String> = Vec::new();\n\n    if let Some(preset_name) = parsed.ignore_symbols_preset.as_deref() {\n        if let Some(set) = preset_ignore_symbols(preset_name) {\n            for s in set {\n                if s.ends_with('*') {\n                    ignore_prefixes.push(s.trim_end_matches('*').to_string());\n                } else {\n                    ignore_exact.insert(s);\n                }\n            }\n        } else {\n            eprintln!(\n                \"[loctree][warn] unknown --ignore-symbols-preset '{}', ignoring\",\n                preset_name\n            );\n        }\n    }\n\n    if let Some(user_syms) = parsed.ignore_symbols.clone() {\n        for s in user_syms {\n            let lc = s.to_lowercase();\n            if lc.ends_with('*') {\n                ignore_prefixes.push(lc.trim_end_matches('*').to_string());\n            } else {\n                ignore_exact.insert(lc);\n            }\n        }\n    }\n\n    let focus_set = opt_globset(&parsed.focus_patterns);\n    let exclude_set = opt_globset(&parsed.exclude_report_patterns);\n\n    if parsed.serve {\n        if let Some((base, handle)) =\n            start_open_server(root_list.to_vec(), parsed.editor_cmd.clone())\n        {\n            server_handle = Some(handle);\n            open_base = Some(base.clone());\n            eprintln!(\"[loctree] local open server at {}\", base);\n        } else {\n            eprintln!(\"[loctree][warn] could not start open server; continue without --serve\");\n        }\n    }\n\n    for (idx, root_path) in root_list.iter().enumerate() {\n        let ignore_paths = normalise_ignore_patterns(&parsed.ignore_patterns, root_path);\n        let mut extensions = parsed.extensions.clone();\n        if extensions.is_none() {\n            extensions = Some(default_analyzer_exts());\n        }\n\n        let options = Options {\n            extensions: extensions.clone(),\n            ignore_paths,\n            use_gitignore: parsed.use_gitignore,\n            max_depth: parsed.max_depth,\n            color: parsed.color,\n            output: parsed.output,\n            summary: parsed.summary,\n            summary_limit: parsed.summary_limit,\n            show_hidden: parsed.show_hidden,\n            loc_threshold: parsed.loc_threshold,\n            analyze_limit: parsed.analyze_limit,\n            report_path: parsed.report_path.clone(),\n            serve: parsed.serve,\n            editor_cmd: parsed.editor_cmd.clone(),\n        };\n\n        let git_checker = if options.use_gitignore {\n            GitIgnoreChecker::new(root_path)\n        } else {\n            None\n        };\n\n        let mut files = Vec::new();\n        gather_files(root_path, &options, 0, git_checker.as_ref(), &mut files)?;\n\n        let mut analyses = Vec::new();\n        let mut export_index: ExportIndex = HashMap::new();\n        let mut reexport_edges: Vec<(String, Option<String>)> = Vec::new();\n        let mut dynamic_summary: Vec<(String, Vec<String>)> = Vec::new();\n        let mut fe_commands: HashMap<String, Vec<(String, usize, String)>> = HashMap::new();\n        let mut be_commands: HashMap<String, Vec<(String, usize, String)>> = HashMap::new();\n        let mut graph_edges: Vec<(String, String, String)> = Vec::new();\n        let mut loc_map: HashMap<String, usize> = HashMap::new();\n\n        for file in files {\n            let analysis = analyze_file(&file, root_path, options.extensions.as_ref())?;\n            loc_map.insert(analysis.path.clone(), analysis.loc);\n            for exp in &analysis.exports {\n                let name_lc = exp.name.to_lowercase();\n                let ignored = ignore_exact.contains(&name_lc)\n                    || ignore_prefixes.iter().any(|p| name_lc.starts_with(p));\n                if ignored {\n                    continue;\n                }\n                export_index\n                    .entry(exp.name.clone())\n                    .or_default()\n                    .push(analysis.path.clone());\n            }\n            for re in &analysis.reexports {\n                reexport_edges.push((analysis.path.clone(), re.resolved.clone()));\n                if parsed.graph && options.report_path.is_some() {\n                    if let Some(target) = &re.resolved {\n                        graph_edges.push((\n                            analysis.path.clone(),\n                            target.clone(),\n                            \"reexport\".to_string(),\n                        ));\n                    }\n                }\n            }\n            if !analysis.dynamic_imports.is_empty() {\n                dynamic_summary.push((analysis.path.clone(), analysis.dynamic_imports.clone()));\n            }\n            if parsed.graph && options.report_path.is_some() {\n                let ext = file\n                    .extension()\n                    .and_then(|e| e.to_str())\n                    .map(|s| s.to_lowercase())\n                    .unwrap_or_default();\n                for imp in &analysis.imports {\n                    let resolved = match ext.as_str() {\n                        \"py\" => {\n                            if imp.source.starts_with('.') {\n                                resolve_python_relative(\n                                    &imp.source,\n                                    &file,\n                                    root_path,\n                                    options.extensions.as_ref(),\n                                )\n                            } else {\n                                None\n                            }\n                        }\n                        \"ts\" | \"tsx\" | \"js\" | \"jsx\" | \"mjs\" | \"cjs\" => {\n                            if imp.source.starts_with('.') {\n                                resolve_js_relative(\n                                    &file,\n                                    root_path,\n                                    &imp.source,\n                                    options.extensions.as_ref(),\n                                )\n                            } else {\n                                None\n                            }\n                        }\n                        _ => None,\n                    };\n                    if let Some(target) = resolved {\n                        graph_edges.push((\n                            analysis.path.clone(),\n                            target,\n                            match imp.kind {\n                                ImportKind::Static | ImportKind::SideEffect => \"import\".to_string(),\n                            },\n                        ));\n                    }\n                }\n            }\n            for call in &analysis.command_calls {\n                fe_commands\n                    .entry(call.name.clone())\n                    .or_default()\n                    .push((analysis.path.clone(), call.line, call.name.clone()));\n            }\n            for handler in &analysis.command_handlers {\n                let key = handler.exposed_name.as_ref().unwrap_or(&handler.name);\n                be_commands\n                    .entry(key.clone())\n                    .or_default()\n                    .push((analysis.path.clone(), handler.line, handler.name.clone()));\n            }\n            analyses.push(analysis);\n        }\n        let duplicate_exports: Vec<_> = export_index\n            .into_iter()\n            .filter(|(_, files)| files.len() > 1)\n            .collect();\n\n        let reexport_files: HashSet<String> = analyses\n            .iter()\n            .filter(|a| !a.reexports.is_empty())\n            .map(|a| a.path.clone())\n            .collect();\n\n        let mut cascades = Vec::new();\n        for (from, resolved) in &reexport_edges {\n            if let Some(target) = resolved {\n                if reexport_files.contains(target) {\n                    cascades.push((from.clone(), target.clone()));\n                }\n            }\n        }\n\n        let mut ranked_dups: Vec<RankedDup> = Vec::new();\n        for (name, files) in &duplicate_exports {\n            let dev_count = files.iter().filter(|f| is_dev_file(f)).count();\n            let prod_count = files.len().saturating_sub(dev_count);\n            let score = prod_count * 2 + dev_count;\n            let canonical = files\n                .iter()\n                .find(|f| !is_dev_file(f))\n                .cloned()\n                .unwrap_or_else(|| files[0].clone());\n            let mut refactors: Vec<String> =\n                files.iter().filter(|f| *f != &canonical).cloned().collect();\n            refactors.sort();\n            ranked_dups.push(RankedDup {\n                name: name.clone(),\n                files: files.clone(),\n                score,\n                prod_count,\n                dev_count,\n                canonical,\n                refactors,\n            });\n        }\n        ranked_dups.sort_by(|a, b| {\n            b.score\n                .cmp(&a.score)\n                .then(b.files.len().cmp(&a.files.len()))\n        });\n\n        let mut filtered_ranked: Vec<RankedDup> = Vec::new();\n        for dup in ranked_dups.into_iter() {\n            let kept_files = strip_excluded(&dup.files, &exclude_set);\n            if kept_files.len() <= 1 {\n                continue;\n            }\n            if !matches_focus(&kept_files, &focus_set) {\n                continue;\n            }\n            let canonical = if kept_files.contains(&dup.canonical) {\n                dup.canonical.clone()\n            } else {\n                kept_files\n                    .iter()\n                    .find(|f| !is_dev_file(f))\n                    .cloned()\n                    .unwrap_or_else(|| kept_files[0].clone())\n            };\n            let dev_count = kept_files.iter().filter(|f| is_dev_file(f)).count();\n            let prod_count = kept_files.len().saturating_sub(dev_count);\n            let score = prod_count * 2 + dev_count;\n            let mut refactors: Vec<String> = kept_files\n                .iter()\n                .filter(|f| *f != &canonical)\n                .cloned()\n                .collect();\n            refactors.sort();\n            filtered_ranked.push(RankedDup {\n                name: dup.name,\n                files: kept_files,\n                score,\n                prod_count,\n                dev_count,\n                canonical,\n                refactors,\n            });\n        }\n        filtered_ranked.sort_by(|a, b| {\n            b.score\n                .cmp(&a.score)\n                .then(b.files.len().cmp(&a.files.len()))\n        });\n\n        let fe_norms: HashMap<String, String> = fe_commands\n            .keys()\n            .map(|k| (k.clone(), normalize_cmd_name(k)))\n            .collect();\n        let be_norms: HashMap<String, String> = be_commands\n            .keys()\n            .map(|k| (k.clone(), normalize_cmd_name(k)))\n            .collect();\n        let be_norm_set: HashSet<String> = be_norms.values().cloned().collect();\n        let fe_norm_set: HashSet<String> = fe_norms.values().cloned().collect();\n\n        let missing_handlers: Vec<CommandGap> = fe_commands\n            .iter()\n            .filter_map(|(name, locs)| {\n                let norm = fe_norms\n                    .get(name)\n                    .cloned()\n                    .unwrap_or_else(|| normalize_cmd_name(name));\n                if be_norm_set.contains(&norm) {\n                    return None;\n                }\n                let kept = strip_excluded_paths(locs, &focus_set, &exclude_set);\n                if kept.is_empty() {\n                    None\n                } else {\n                    let impl_name = locs.iter()\n                        .find(|(p, l, _)| p == &kept[0].0 && *l == kept[0].1)\n                        .map(|(_, _, n)| n.clone());\n                    Some(CommandGap {\n                        name: name.clone(),\n                        implementation_name: impl_name,\n                        locations: kept,\n                    })\n                }\n            })\n            .collect();\n        let unused_handlers: Vec<CommandGap> = be_commands\n            .iter()\n            .filter_map(|(name, locs)| {\n                let norm = be_norms\n                    .get(name)\n                    .cloned()\n                    .unwrap_or_else(|| normalize_cmd_name(name));\n                if fe_norm_set.contains(&norm) {\n                    return None;\n                }\n                let kept = strip_excluded_paths(locs, &focus_set, &exclude_set);\n                if kept.is_empty() {\n                    None\n                } else {\n                    let impl_name = locs.iter()\n                        .find(|(p, l, _)| p == &kept[0].0 && *l == kept[0].1)\n                        .map(|(_, _, n)| n.clone());\n                    Some(CommandGap {\n                        name: name.clone(),\n                        implementation_name: impl_name,\n                        locations: kept,\n                    })\n                }\n            })\n            .collect();\n\n        let mut section_open = None;\n        if options.report_path.is_some() && options.serve {\n            section_open = open_base.clone().or_else(current_open_base);\n        }\n\n        if options.report_path.is_some() {\n            let mut sorted_dyn = dynamic_summary.clone();\n            sorted_dyn.sort_by(|a, b| b.1.len().cmp(&a.1.len()));\n\n            let insights = collect_ai_insights(\n                &analyses,\n                &filtered_ranked,\n                &cascades,\n                &missing_handlers,\n                &unused_handlers,\n            );\n\n            report_sections.push(ReportSection {\n                insights,\n                root: root_path.display().to_string(),\n                files_analyzed: analyses.len(),\n                ranked_dups: filtered_ranked.clone(),\n                cascades: cascades.clone(),\n                dynamic: sorted_dyn,\n                analyze_limit: options.analyze_limit,\n                missing_handlers: {\n                    let mut v = missing_handlers.clone();\n                    v.sort_by(|a, b| a.name.cmp(&b.name));\n                    v\n                },\n                unused_handlers: {\n                    let mut v = unused_handlers.clone();\n                    v.sort_by(|a, b| a.name.cmp(&b.name));\n                    v\n                },\n                command_counts: (fe_commands.len(), be_commands.len()),\n                open_base: section_open,\n                graph: if parsed.graph && options.report_path.is_some() && !graph_edges.is_empty() {\n                    let mut nodes: HashSet<String> = HashSet::new();\n                    for (a, b, _) in &graph_edges {\n                        if !a.is_empty() {\n                            nodes.insert(a.clone());\n                        }\n                        if !b.is_empty() {\n                            nodes.insert(b.clone());\n                        }\n                    }\n                    if nodes.len() > MAX_GRAPH_NODES || graph_edges.len() > MAX_GRAPH_EDGES {\n                        eprintln!(\n                            \"[loctree][warn] graph skipped ({} nodes, {} edges > limits)\",\n                            nodes.len(),\n                            graph_edges.len()\n                        );\n                        None\n                    } else {\n                        let nodes_vec: Vec<String> = nodes.into_iter().collect();\n                        let positions = layout_positions(&nodes_vec, &graph_edges);\n                        let graph_nodes: Vec<GraphNode> = nodes_vec\n                            .iter()\n                            .filter_map(|id| {\n                                if id.is_empty() {\n                                    return None;\n                                }\n                                let (x, y) = positions.get(id).cloned().unwrap_or((0.0, 0.0));\n                                let loc = loc_map.get(id).cloned().unwrap_or(0);\n                                let label =\n                                    id.rsplit('/').next().unwrap_or(id.as_str()).to_string();\n                                Some(GraphNode {\n                                    id: id.clone(),\n                                    label,\n                                    loc,\n                                    x,\n                                    y,\n                                })\n                            })\n                            .collect();\n                        Some(GraphData {\n                            nodes: graph_nodes,\n                            edges: graph_edges.clone(),\n                        })\n                    }\n                } else {\n                    None\n                },\n            });\n        }\n\n        if matches!(options.output, OutputMode::Json | OutputMode::Jsonl) {\n            let files_json: Vec<_> = analyses\n                .iter()\n                .map(|a| {\n                    json!({\n                        \"path\": a.path,\n                        \"imports\": a.imports.iter().map(|i| json!({\"source\": i.source, \"kind\": match i.kind { ImportKind::Static => \"static\", ImportKind::SideEffect => \"side-effect\" }})).collect::<Vec<_>>(),\n                        \"reexports\": a.reexports.iter().map(|r| {\n                            match &r.kind {\n                                ReexportKind::Star => json!({\"source\": r.source, \"kind\": \"star\", \"resolved\": r.resolved}),\n                                ReexportKind::Named(names) => json!({\"source\": r.source, \"kind\": \"named\", \"names\": names, \"resolved\": r.resolved})\n                            }\n                        }).collect::<Vec<_>>(),\n                        \"dynamicImports\": a.dynamic_imports,\n                        \"exports\": a.exports.iter().map(|e| json!({\"name\": e.name, \"kind\": e.kind})).collect::<Vec<_>>(),\n                        \"commandCalls\": a.command_calls.iter().map(|c| json!({\"name\": c.name, \"line\": c.line})).collect::<Vec<_>>(),\n                        \"commandHandlers\": a.command_handlers.iter().map(|c| json!({\"name\": c.name, \"line\": c.line})).collect::<Vec<_>>(),\n                    })\n                })\n                .collect();\n\n            let payload = json!({\n                \"root\": root_path,\n                \"filesAnalyzed\": analyses.len(),\n                \"duplicateExports\": filtered_ranked\n                    .iter()\n                    .map(|dup| json!({\"name\": dup.name, \"files\": dup.files}))\n                    .collect::<Vec<_>>(),\n                \"duplicateExportsRanked\": filtered_ranked\n                    .iter()\n                    .map(|dup| json!({\n                        \"name\": dup.name,\n                        \"files\": dup.files,\n                        \"score\": dup.score,\n                        \"nonDevCount\": dup.prod_count,\n                        \"devCount\": dup.dev_count,\n                        \"canonical\": dup.canonical,\n                        \"refactorTargets\": dup.refactors,\n                    }))\n                    .collect::<Vec<_>>(),\n                \"reexportCascades\": cascades\n                    .iter()\n                    .map(|(from, to)| json!({\"from\": from, \"to\": to}))\n                    .collect::<Vec<_>>(),\n                \"dynamicImports\": dynamic_summary\n                    .iter()\n                    .map(|(file, sources)| {\n                        let unique: HashSet<_> = sources.iter().collect();\n                        json!({\n                            \"file\": file,\n                            \"sources\": sources,\n                            \"manySources\": sources.len() > 5,\n                            \"selfImport\": unique.len() < sources.len(),\n                    })\n                })\n                .collect::<Vec<_>>(),\n                \"commands\": {\n                    \"frontend\": fe_commands.iter().map(|(k,v)| json!({\"name\": k, \"locations\": v})).collect::<Vec<_>>(),\n                    \"backend\": be_commands.iter().map(|(k,v)| json!({\"name\": k, \"locations\": v})).collect::<Vec<_>>(),\n                    \"missingHandlers\": missing_handlers.iter().map(|g| json!({\"name\": g.name, \"locations\": g.locations})).collect::<Vec<_>>(),\n                    \"unusedHandlers\": unused_handlers.iter().map(|g| json!({\"name\": g.name, \"locations\": g.locations})).collect::<Vec<_>>(),\n                },\n                \"files\": files_json,\n            });\n\n            if matches!(options.output, OutputMode::Jsonl) {\n                println!(\"{}\", serde_json::to_string(&payload).unwrap());\n            } else {\n                json_results.push(payload);\n            }\n            continue;\n        }\n\n        if idx > 0 {\n            println!();\n        }\n\n        println!(\"Import/export analysis for {}/\", root_path.display());\n        println!(\"  Files analyzed: {}\", analyses.len());\n        println!(\"  Duplicate exports: {}\", filtered_ranked.len());\n        println!(\"  Files with re-exports: {}\", reexport_files.len());\n        println!(\"  Dynamic imports: {}\", dynamic_summary.len());\n\n        if !duplicate_exports.is_empty() {\n            println!(\n                \"\\nTop duplicate exports (showing up to {}):\",\n                options.analyze_limit\n            );\n            for dup in filtered_ranked.iter().take(options.analyze_limit) {\n                println!(\n                    \"  - {} (score {}, {} files: {} prod, {} dev) canonical: {} | refs: {}\",\n                    dup.name,\n                    dup.score,\n                    dup.files.len(),\n                    dup.prod_count,\n                    dup.dev_count,\n                    dup.canonical,\n                    dup.refactors.join(\", \")\n                );\n            }\n        }\n\n        if !cascades.is_empty() {\n            println!(\"\\nRe-export cascades:\");\n            for (from, to) in &cascades {\n                println!(\"  - {} -> {}\", from, to);\n            }\n        }\n\n        if !dynamic_summary.is_empty() {\n            println!(\n                \"\\nDynamic imports (showing up to {}):\",\n                options.analyze_limit\n            );\n            let mut sorted_dyn = dynamic_summary.clone();\n            sorted_dyn.sort_by(|a, b| b.1.len().cmp(&a.1.len()));\n            for (file, sources) in sorted_dyn.iter().take(options.analyze_limit) {\n                println!(\n                    \"  - {}: {}{}\",\n                    file,\n                    sources.join(\", \"),\n                    if sources.len() > 5 {\n                        \"  [many sources]\"\n                    } else {\n                        \"\"\n                    }\n                );\n            }\n        }\n\n        if !missing_handlers.is_empty() || !unused_handlers.is_empty() {\n            println!(\"\\nTauri command coverage:\");\n            if !missing_handlers.is_empty() {\n                println!(\n                    \"  Missing handlers (frontend calls without backend): {}\",\n                    missing_handlers\n                        .iter()\n                        .map(|g| g.name.clone())\n                        .collect::<Vec<_>>()\n                        .join(\", \")\n                );\n            }\n            if !unused_handlers.is_empty() {\n                println!(\n                    \"  Unused handlers (backend not called by FE): {}\",\n                    unused_handlers\n                        .iter()\n                        .map(|g| g.name.clone())\n                        .collect::<Vec<_>>()\n                        .join(\", \")\n                );\n            }\n        }\n\n        println!(\"\\nTip: rerun with --json for machine-readable output.\");\n    }\n\n    if matches!(parsed.output, OutputMode::Json) {\n        let payload = if json_results.len() == 1 {\n            serde_json::to_string_pretty(&json_results[0]).unwrap()\n        } else {\n            serde_json::to_string_pretty(&json_results).unwrap()\n        };\n        if let Some(path) = parsed.json_output_path.as_ref() {\n            if let Some(dir) = path.parent() {\n                let _ = fs::create_dir_all(dir);\n            }\n            if let Err(err) = fs::write(path, payload.as_bytes()) {\n                eprintln!(\n                    \"[loctree][warn] failed to write JSON to {}: {}\",\n                    path.display(),\n                    err\n                );\n            } else {\n                eprintln!(\"[loctree] JSON written to {}\", path.display());\n            }\n        } else {\n            println!(\"{}\", payload);\n        }\n    }\n\n    if let Some(report_path) = parsed.report_path.as_ref() {\n        render_html_report(report_path, &report_sections)?;\n        eprintln!(\"[loctree] HTML report written to {}\", report_path.display());\n        open_in_browser(report_path);\n    }\n\n    drop(server_handle);\n\n    if parsed.serve {\n        use std::io::Read;\n        eprintln!(\"[loctree] --serve: wciśnij Enter (Ctrl+C aby przerwać) aby zakończyć serwer\");\n        let _ = std::io::stdin().read(&mut [0u8]).ok();\n    }\n    Ok(())\n}\n","traces":[{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":322,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":339,"address":[],"length":0,"stats":{"Line":0}},{"line":340,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":355,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":362,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":364,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":368,"address":[],"length":0,"stats":{"Line":0}},{"line":370,"address":[],"length":0,"stats":{"Line":0}},{"line":371,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":380,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":383,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":386,"address":[],"length":0,"stats":{"Line":0}},{"line":387,"address":[],"length":0,"stats":{"Line":0}},{"line":388,"address":[],"length":0,"stats":{"Line":0}},{"line":389,"address":[],"length":0,"stats":{"Line":0}},{"line":390,"address":[],"length":0,"stats":{"Line":0}},{"line":391,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":397,"address":[],"length":0,"stats":{"Line":0}},{"line":398,"address":[],"length":0,"stats":{"Line":0}},{"line":400,"address":[],"length":0,"stats":{"Line":0}},{"line":401,"address":[],"length":0,"stats":{"Line":0}},{"line":403,"address":[],"length":0,"stats":{"Line":0}},{"line":404,"address":[],"length":0,"stats":{"Line":0}},{"line":406,"address":[],"length":0,"stats":{"Line":0}},{"line":407,"address":[],"length":0,"stats":{"Line":0}},{"line":408,"address":[],"length":0,"stats":{"Line":0}},{"line":409,"address":[],"length":0,"stats":{"Line":0}},{"line":411,"address":[],"length":0,"stats":{"Line":0}},{"line":412,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":0}},{"line":417,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":421,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":429,"address":[],"length":0,"stats":{"Line":0}},{"line":432,"address":[],"length":0,"stats":{"Line":0}},{"line":434,"address":[],"length":0,"stats":{"Line":0}},{"line":435,"address":[],"length":0,"stats":{"Line":0}},{"line":436,"address":[],"length":0,"stats":{"Line":0}},{"line":437,"address":[],"length":0,"stats":{"Line":0}},{"line":438,"address":[],"length":0,"stats":{"Line":0}},{"line":439,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":446,"address":[],"length":0,"stats":{"Line":0}},{"line":447,"address":[],"length":0,"stats":{"Line":0}},{"line":449,"address":[],"length":0,"stats":{"Line":0}},{"line":451,"address":[],"length":0,"stats":{"Line":0}},{"line":452,"address":[],"length":0,"stats":{"Line":0}},{"line":453,"address":[],"length":0,"stats":{"Line":0}},{"line":454,"address":[],"length":0,"stats":{"Line":0}},{"line":456,"address":[],"length":0,"stats":{"Line":0}},{"line":458,"address":[],"length":0,"stats":{"Line":0}},{"line":460,"address":[],"length":0,"stats":{"Line":0}},{"line":462,"address":[],"length":0,"stats":{"Line":0}},{"line":465,"address":[],"length":0,"stats":{"Line":0}},{"line":467,"address":[],"length":0,"stats":{"Line":0}},{"line":468,"address":[],"length":0,"stats":{"Line":0}},{"line":471,"address":[],"length":0,"stats":{"Line":0}},{"line":472,"address":[],"length":0,"stats":{"Line":0}},{"line":473,"address":[],"length":0,"stats":{"Line":0}},{"line":474,"address":[],"length":0,"stats":{"Line":0}},{"line":475,"address":[],"length":0,"stats":{"Line":0}},{"line":480,"address":[],"length":0,"stats":{"Line":0}},{"line":481,"address":[],"length":0,"stats":{"Line":0}},{"line":482,"address":[],"length":0,"stats":{"Line":0}},{"line":483,"address":[],"length":0,"stats":{"Line":0}},{"line":484,"address":[],"length":0,"stats":{"Line":0}},{"line":485,"address":[],"length":0,"stats":{"Line":0}},{"line":487,"address":[],"length":0,"stats":{"Line":0}},{"line":489,"address":[],"length":0,"stats":{"Line":0}},{"line":490,"address":[],"length":0,"stats":{"Line":0}},{"line":491,"address":[],"length":0,"stats":{"Line":0}},{"line":492,"address":[],"length":0,"stats":{"Line":0}},{"line":493,"address":[],"length":0,"stats":{"Line":0}},{"line":494,"address":[],"length":0,"stats":{"Line":0}},{"line":495,"address":[],"length":0,"stats":{"Line":0}},{"line":496,"address":[],"length":0,"stats":{"Line":0}},{"line":497,"address":[],"length":0,"stats":{"Line":0}},{"line":498,"address":[],"length":0,"stats":{"Line":0}},{"line":499,"address":[],"length":0,"stats":{"Line":0}},{"line":500,"address":[],"length":0,"stats":{"Line":0}},{"line":503,"address":[],"length":0,"stats":{"Line":0}},{"line":504,"address":[],"length":0,"stats":{"Line":0}},{"line":505,"address":[],"length":0,"stats":{"Line":0}},{"line":506,"address":[],"length":0,"stats":{"Line":0}},{"line":509,"address":[],"length":0,"stats":{"Line":0}},{"line":510,"address":[],"length":0,"stats":{"Line":0}},{"line":511,"address":[],"length":0,"stats":{"Line":0}},{"line":512,"address":[],"length":0,"stats":{"Line":0}},{"line":513,"address":[],"length":0,"stats":{"Line":0}},{"line":515,"address":[],"length":0,"stats":{"Line":0}},{"line":516,"address":[],"length":0,"stats":{"Line":0}},{"line":518,"address":[],"length":0,"stats":{"Line":0}},{"line":519,"address":[],"length":0,"stats":{"Line":0}},{"line":521,"address":[],"length":0,"stats":{"Line":0}},{"line":523,"address":[],"length":0,"stats":{"Line":0}},{"line":525,"address":[],"length":0,"stats":{"Line":0}},{"line":527,"address":[],"length":0,"stats":{"Line":0}},{"line":528,"address":[],"length":0,"stats":{"Line":0}},{"line":529,"address":[],"length":0,"stats":{"Line":0}},{"line":530,"address":[],"length":0,"stats":{"Line":0}},{"line":532,"address":[],"length":0,"stats":{"Line":0}},{"line":535,"address":[],"length":0,"stats":{"Line":0}},{"line":536,"address":[],"length":0,"stats":{"Line":0}},{"line":537,"address":[],"length":0,"stats":{"Line":0}},{"line":538,"address":[],"length":0,"stats":{"Line":0}},{"line":539,"address":[],"length":0,"stats":{"Line":0}},{"line":540,"address":[],"length":0,"stats":{"Line":0}},{"line":541,"address":[],"length":0,"stats":{"Line":0}},{"line":542,"address":[],"length":0,"stats":{"Line":0}},{"line":543,"address":[],"length":0,"stats":{"Line":0}},{"line":546,"address":[],"length":0,"stats":{"Line":0}},{"line":547,"address":[],"length":0,"stats":{"Line":0}},{"line":548,"address":[],"length":0,"stats":{"Line":0}},{"line":549,"address":[],"length":0,"stats":{"Line":0}},{"line":552,"address":[],"length":0,"stats":{"Line":0}},{"line":554,"address":[],"length":0,"stats":{"Line":0}},{"line":556,"address":[],"length":0,"stats":{"Line":0}},{"line":558,"address":[],"length":0,"stats":{"Line":0}},{"line":560,"address":[],"length":0,"stats":{"Line":0}},{"line":561,"address":[],"length":0,"stats":{"Line":0}},{"line":563,"address":[],"length":0,"stats":{"Line":0}},{"line":565,"address":[],"length":0,"stats":{"Line":0}},{"line":566,"address":[],"length":0,"stats":{"Line":0}},{"line":567,"address":[],"length":0,"stats":{"Line":0}},{"line":568,"address":[],"length":0,"stats":{"Line":0}},{"line":569,"address":[],"length":0,"stats":{"Line":0}},{"line":570,"address":[],"length":0,"stats":{"Line":0}},{"line":571,"address":[],"length":0,"stats":{"Line":0}},{"line":573,"address":[],"length":0,"stats":{"Line":0}},{"line":574,"address":[],"length":0,"stats":{"Line":0}},{"line":575,"address":[],"length":0,"stats":{"Line":0}},{"line":577,"address":[],"length":0,"stats":{"Line":0}},{"line":578,"address":[],"length":0,"stats":{"Line":0}},{"line":579,"address":[],"length":0,"stats":{"Line":0}},{"line":580,"address":[],"length":0,"stats":{"Line":0}},{"line":581,"address":[],"length":0,"stats":{"Line":0}},{"line":582,"address":[],"length":0,"stats":{"Line":0}},{"line":583,"address":[],"length":0,"stats":{"Line":0}},{"line":588,"address":[],"length":0,"stats":{"Line":0}},{"line":590,"address":[],"length":0,"stats":{"Line":0}},{"line":591,"address":[],"length":0,"stats":{"Line":0}},{"line":592,"address":[],"length":0,"stats":{"Line":0}},{"line":593,"address":[],"length":0,"stats":{"Line":0}},{"line":594,"address":[],"length":0,"stats":{"Line":0}},{"line":595,"address":[],"length":0,"stats":{"Line":0}},{"line":596,"address":[],"length":0,"stats":{"Line":0}},{"line":598,"address":[],"length":0,"stats":{"Line":0}},{"line":599,"address":[],"length":0,"stats":{"Line":0}},{"line":600,"address":[],"length":0,"stats":{"Line":0}},{"line":602,"address":[],"length":0,"stats":{"Line":0}},{"line":603,"address":[],"length":0,"stats":{"Line":0}},{"line":604,"address":[],"length":0,"stats":{"Line":0}},{"line":605,"address":[],"length":0,"stats":{"Line":0}},{"line":606,"address":[],"length":0,"stats":{"Line":0}},{"line":607,"address":[],"length":0,"stats":{"Line":0}},{"line":608,"address":[],"length":0,"stats":{"Line":0}},{"line":614,"address":[],"length":0,"stats":{"Line":0}},{"line":615,"address":[],"length":0,"stats":{"Line":0}},{"line":616,"address":[],"length":0,"stats":{"Line":0}},{"line":619,"address":[],"length":0,"stats":{"Line":0}},{"line":620,"address":[],"length":0,"stats":{"Line":0}},{"line":621,"address":[],"length":0,"stats":{"Line":0}},{"line":624,"address":[],"length":0,"stats":{"Line":0}},{"line":625,"address":[],"length":0,"stats":{"Line":0}},{"line":626,"address":[],"length":0,"stats":{"Line":0}},{"line":627,"address":[],"length":0,"stats":{"Line":0}},{"line":628,"address":[],"length":0,"stats":{"Line":0}},{"line":631,"address":[],"length":0,"stats":{"Line":0}},{"line":632,"address":[],"length":0,"stats":{"Line":0}},{"line":633,"address":[],"length":0,"stats":{"Line":0}},{"line":634,"address":[],"length":0,"stats":{"Line":0}},{"line":635,"address":[],"length":0,"stats":{"Line":0}},{"line":636,"address":[],"length":0,"stats":{"Line":0}},{"line":637,"address":[],"length":0,"stats":{"Line":0}},{"line":638,"address":[],"length":0,"stats":{"Line":0}},{"line":640,"address":[],"length":0,"stats":{"Line":0}},{"line":641,"address":[],"length":0,"stats":{"Line":0}},{"line":642,"address":[],"length":0,"stats":{"Line":0}},{"line":645,"address":[],"length":0,"stats":{"Line":0}},{"line":646,"address":[],"length":0,"stats":{"Line":0}},{"line":647,"address":[],"length":0,"stats":{"Line":0}},{"line":649,"address":[],"length":0,"stats":{"Line":0}},{"line":650,"address":[],"length":0,"stats":{"Line":0}},{"line":651,"address":[],"length":0,"stats":{"Line":0}},{"line":652,"address":[],"length":0,"stats":{"Line":0}},{"line":653,"address":[],"length":0,"stats":{"Line":0}},{"line":654,"address":[],"length":0,"stats":{"Line":0}},{"line":655,"address":[],"length":0,"stats":{"Line":0}},{"line":657,"address":[],"length":0,"stats":{"Line":0}},{"line":658,"address":[],"length":0,"stats":{"Line":0}},{"line":661,"address":[],"length":0,"stats":{"Line":0}},{"line":662,"address":[],"length":0,"stats":{"Line":0}},{"line":663,"address":[],"length":0,"stats":{"Line":0}},{"line":664,"address":[],"length":0,"stats":{"Line":0}},{"line":665,"address":[],"length":0,"stats":{"Line":0}},{"line":667,"address":[],"length":0,"stats":{"Line":0}},{"line":669,"address":[],"length":0,"stats":{"Line":0}},{"line":670,"address":[],"length":0,"stats":{"Line":0}},{"line":671,"address":[],"length":0,"stats":{"Line":0}},{"line":672,"address":[],"length":0,"stats":{"Line":0}},{"line":673,"address":[],"length":0,"stats":{"Line":0}},{"line":674,"address":[],"length":0,"stats":{"Line":0}},{"line":675,"address":[],"length":0,"stats":{"Line":0}},{"line":677,"address":[],"length":0,"stats":{"Line":0}},{"line":678,"address":[],"length":0,"stats":{"Line":0}},{"line":679,"address":[],"length":0,"stats":{"Line":0}},{"line":680,"address":[],"length":0,"stats":{"Line":0}},{"line":681,"address":[],"length":0,"stats":{"Line":0}},{"line":682,"address":[],"length":0,"stats":{"Line":0}},{"line":683,"address":[],"length":0,"stats":{"Line":0}},{"line":684,"address":[],"length":0,"stats":{"Line":0}},{"line":685,"address":[],"length":0,"stats":{"Line":0}},{"line":686,"address":[],"length":0,"stats":{"Line":0}},{"line":689,"address":[],"length":0,"stats":{"Line":0}},{"line":690,"address":[],"length":0,"stats":{"Line":0}},{"line":691,"address":[],"length":0,"stats":{"Line":0}},{"line":692,"address":[],"length":0,"stats":{"Line":0}},{"line":696,"address":[],"length":0,"stats":{"Line":0}},{"line":701,"address":[],"length":0,"stats":{"Line":0}},{"line":702,"address":[],"length":0,"stats":{"Line":0}},{"line":704,"address":[],"length":0,"stats":{"Line":0}},{"line":705,"address":[],"length":0,"stats":{"Line":0}},{"line":706,"address":[],"length":0,"stats":{"Line":0}},{"line":707,"address":[],"length":0,"stats":{"Line":0}},{"line":708,"address":[],"length":0,"stats":{"Line":0}},{"line":709,"address":[],"length":0,"stats":{"Line":0}},{"line":710,"address":[],"length":0,"stats":{"Line":0}},{"line":711,"address":[],"length":0,"stats":{"Line":0}},{"line":713,"address":[],"length":0,"stats":{"Line":0}},{"line":714,"address":[],"length":0,"stats":{"Line":0}},{"line":715,"address":[],"length":0,"stats":{"Line":0}},{"line":716,"address":[],"length":0,"stats":{"Line":0}},{"line":717,"address":[],"length":0,"stats":{"Line":0}},{"line":722,"address":[],"length":0,"stats":{"Line":0}},{"line":723,"address":[],"length":0,"stats":{"Line":0}},{"line":724,"address":[],"length":0,"stats":{"Line":0}},{"line":725,"address":[],"length":0,"stats":{"Line":0}},{"line":726,"address":[],"length":0,"stats":{"Line":0}},{"line":727,"address":[],"length":0,"stats":{"Line":0}},{"line":728,"address":[],"length":0,"stats":{"Line":0}},{"line":729,"address":[],"length":0,"stats":{"Line":0}},{"line":730,"address":[],"length":0,"stats":{"Line":0}},{"line":731,"address":[],"length":0,"stats":{"Line":0}},{"line":732,"address":[],"length":0,"stats":{"Line":0}},{"line":733,"address":[],"length":0,"stats":{"Line":0}},{"line":734,"address":[],"length":0,"stats":{"Line":0}},{"line":735,"address":[],"length":0,"stats":{"Line":0}},{"line":736,"address":[],"length":0,"stats":{"Line":0}},{"line":737,"address":[],"length":0,"stats":{"Line":0}},{"line":738,"address":[],"length":0,"stats":{"Line":0}},{"line":740,"address":[],"length":0,"stats":{"Line":0}},{"line":741,"address":[],"length":0,"stats":{"Line":0}},{"line":742,"address":[],"length":0,"stats":{"Line":0}},{"line":743,"address":[],"length":0,"stats":{"Line":0}},{"line":744,"address":[],"length":0,"stats":{"Line":0}},{"line":745,"address":[],"length":0,"stats":{"Line":0}},{"line":746,"address":[],"length":0,"stats":{"Line":0}},{"line":747,"address":[],"length":0,"stats":{"Line":0}},{"line":748,"address":[],"length":0,"stats":{"Line":0}},{"line":749,"address":[],"length":0,"stats":{"Line":0}},{"line":750,"address":[],"length":0,"stats":{"Line":0}},{"line":751,"address":[],"length":0,"stats":{"Line":0}},{"line":752,"address":[],"length":0,"stats":{"Line":0}},{"line":753,"address":[],"length":0,"stats":{"Line":0}},{"line":756,"address":[],"length":0,"stats":{"Line":0}},{"line":757,"address":[],"length":0,"stats":{"Line":0}},{"line":758,"address":[],"length":0,"stats":{"Line":0}},{"line":759,"address":[],"length":0,"stats":{"Line":0}},{"line":760,"address":[],"length":0,"stats":{"Line":0}},{"line":761,"address":[],"length":0,"stats":{"Line":0}},{"line":763,"address":[],"length":0,"stats":{"Line":0}},{"line":766,"address":[],"length":0,"stats":{"Line":0}},{"line":767,"address":[],"length":0,"stats":{"Line":0}},{"line":769,"address":[],"length":0,"stats":{"Line":0}},{"line":771,"address":[],"length":0,"stats":{"Line":0}},{"line":774,"address":[],"length":0,"stats":{"Line":0}},{"line":775,"address":[],"length":0,"stats":{"Line":0}},{"line":778,"address":[],"length":0,"stats":{"Line":0}},{"line":779,"address":[],"length":0,"stats":{"Line":0}},{"line":780,"address":[],"length":0,"stats":{"Line":0}},{"line":781,"address":[],"length":0,"stats":{"Line":0}},{"line":782,"address":[],"length":0,"stats":{"Line":0}},{"line":784,"address":[],"length":0,"stats":{"Line":0}},{"line":785,"address":[],"length":0,"stats":{"Line":0}},{"line":786,"address":[],"length":0,"stats":{"Line":0}},{"line":789,"address":[],"length":0,"stats":{"Line":0}},{"line":790,"address":[],"length":0,"stats":{"Line":0}},{"line":791,"address":[],"length":0,"stats":{"Line":0}},{"line":792,"address":[],"length":0,"stats":{"Line":0}},{"line":793,"address":[],"length":0,"stats":{"Line":0}},{"line":794,"address":[],"length":0,"stats":{"Line":0}},{"line":795,"address":[],"length":0,"stats":{"Line":0}},{"line":796,"address":[],"length":0,"stats":{"Line":0}},{"line":797,"address":[],"length":0,"stats":{"Line":0}},{"line":798,"address":[],"length":0,"stats":{"Line":0}},{"line":803,"address":[],"length":0,"stats":{"Line":0}},{"line":804,"address":[],"length":0,"stats":{"Line":0}},{"line":805,"address":[],"length":0,"stats":{"Line":0}},{"line":806,"address":[],"length":0,"stats":{"Line":0}},{"line":810,"address":[],"length":0,"stats":{"Line":0}},{"line":811,"address":[],"length":0,"stats":{"Line":0}},{"line":812,"address":[],"length":0,"stats":{"Line":0}},{"line":815,"address":[],"length":0,"stats":{"Line":0}},{"line":816,"address":[],"length":0,"stats":{"Line":0}},{"line":817,"address":[],"length":0,"stats":{"Line":0}},{"line":818,"address":[],"length":0,"stats":{"Line":0}},{"line":819,"address":[],"length":0,"stats":{"Line":0}},{"line":821,"address":[],"length":0,"stats":{"Line":0}},{"line":822,"address":[],"length":0,"stats":{"Line":0}},{"line":823,"address":[],"length":0,"stats":{"Line":0}},{"line":825,"address":[],"length":0,"stats":{"Line":0}},{"line":831,"address":[],"length":0,"stats":{"Line":0}},{"line":832,"address":[],"length":0,"stats":{"Line":0}},{"line":833,"address":[],"length":0,"stats":{"Line":0}},{"line":834,"address":[],"length":0,"stats":{"Line":0}},{"line":835,"address":[],"length":0,"stats":{"Line":0}},{"line":836,"address":[],"length":0,"stats":{"Line":0}},{"line":837,"address":[],"length":0,"stats":{"Line":0}},{"line":838,"address":[],"length":0,"stats":{"Line":0}},{"line":839,"address":[],"length":0,"stats":{"Line":0}},{"line":840,"address":[],"length":0,"stats":{"Line":0}},{"line":843,"address":[],"length":0,"stats":{"Line":0}},{"line":844,"address":[],"length":0,"stats":{"Line":0}},{"line":845,"address":[],"length":0,"stats":{"Line":0}},{"line":846,"address":[],"length":0,"stats":{"Line":0}},{"line":847,"address":[],"length":0,"stats":{"Line":0}},{"line":848,"address":[],"length":0,"stats":{"Line":0}},{"line":849,"address":[],"length":0,"stats":{"Line":0}},{"line":850,"address":[],"length":0,"stats":{"Line":0}},{"line":855,"address":[],"length":0,"stats":{"Line":0}},{"line":858,"address":[],"length":0,"stats":{"Line":0}},{"line":859,"address":[],"length":0,"stats":{"Line":0}},{"line":860,"address":[],"length":0,"stats":{"Line":0}},{"line":862,"address":[],"length":0,"stats":{"Line":0}},{"line":864,"address":[],"length":0,"stats":{"Line":0}},{"line":865,"address":[],"length":0,"stats":{"Line":0}},{"line":866,"address":[],"length":0,"stats":{"Line":0}},{"line":868,"address":[],"length":0,"stats":{"Line":0}},{"line":869,"address":[],"length":0,"stats":{"Line":0}},{"line":870,"address":[],"length":0,"stats":{"Line":0}},{"line":871,"address":[],"length":0,"stats":{"Line":0}},{"line":872,"address":[],"length":0,"stats":{"Line":0}},{"line":875,"address":[],"length":0,"stats":{"Line":0}},{"line":878,"address":[],"length":0,"stats":{"Line":0}},{"line":882,"address":[],"length":0,"stats":{"Line":0}},{"line":883,"address":[],"length":0,"stats":{"Line":0}},{"line":884,"address":[],"length":0,"stats":{"Line":0}},{"line":885,"address":[],"length":0,"stats":{"Line":0}},{"line":888,"address":[],"length":0,"stats":{"Line":0}},{"line":890,"address":[],"length":0,"stats":{"Line":0}},{"line":892,"address":[],"length":0,"stats":{"Line":0}},{"line":893,"address":[],"length":0,"stats":{"Line":0}},{"line":895,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":571},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","analyzer","rust.rs"],"content":"use crate::types::{\n    CommandRef, ExportSymbol, FileAnalysis, ImportEntry, ImportKind, ReexportEntry, ReexportKind,\n};\n\nuse super::offset_to_line;\nuse super::regexes::{\n    regex_rust_pub_use, regex_rust_use, regex_tauri_command_fn, rust_pub_const_regexes,\n    rust_pub_decl_regexes,\n};\n\nfn split_words_lower(name: &str) -> Vec<String> {\n    let mut words = Vec::new();\n    let mut current = String::new();\n    let mut prev_lower = false;\n\n    for ch in name.chars() {\n        if ch == '_' || ch == '-' {\n            if !current.is_empty() {\n                words.push(current.to_lowercase());\n                current.clear();\n            }\n            prev_lower = false;\n            continue;\n        }\n\n        if ch.is_ascii_uppercase() && prev_lower && !current.is_empty() {\n            words.push(current.to_lowercase());\n            current.clear();\n        }\n\n        current.push(ch);\n        prev_lower = ch.is_ascii_lowercase();\n    }\n\n    if !current.is_empty() {\n        words.push(current.to_lowercase());\n    }\n\n    words.retain(|w| !w.is_empty());\n    words\n}\n\nfn capitalize(word: &str) -> String {\n    let mut chars = word.chars();\n    match chars.next() {\n        Some(first) => format!(\"{}{}\", first.to_ascii_uppercase(), chars.as_str()),\n        None => String::new(),\n    }\n}\n\nfn apply_rename_all(fn_name: &str, style: &str) -> String {\n    let words = split_words_lower(fn_name);\n    if words.is_empty() {\n        return fn_name.to_string();\n    }\n\n    match style {\n        \"snake_case\" => words.join(\"_\"),\n        \"kebab-case\" => words.join(\"-\"),\n        \"camelCase\" => {\n            let mut out = words[0].clone();\n            for w in words.iter().skip(1) {\n                out.push_str(&capitalize(w));\n            }\n            out\n        }\n        \"PascalCase\" | \"UpperCamelCase\" => {\n            let mut out = String::new();\n            for w in &words {\n                out.push_str(&capitalize(w));\n            }\n            out\n        }\n        \"lowercase\" => words.join(\"\").to_lowercase(),\n        \"UPPERCASE\" => words.join(\"\").to_uppercase(),\n        \"SCREAMING_SNAKE_CASE\" => words.join(\"_\").to_uppercase(),\n        _ => fn_name.to_string(),\n    }\n}\n\nfn exposed_command_name(attr_raw: &str, fn_name: &str) -> String {\n    let inner = attr_raw\n        .trim()\n        .trim_start_matches('(')\n        .trim_end_matches(')')\n        .trim();\n\n    if inner.is_empty() {\n        return fn_name.to_string();\n    }\n\n    let mut rename: Option<String> = None;\n    let mut rename_all: Option<String> = None;\n\n    for part in inner.split(',') {\n        let trimmed = part.trim();\n        if trimmed.is_empty() {\n            continue;\n        }\n\n        if let Some((key, raw_val)) = trimmed.split_once('=') {\n            let key = key.trim();\n            let val = raw_val.trim().trim_matches(['\"', '\\'']).to_string();\n            if val.is_empty() {\n                continue;\n            }\n            if key == \"rename\" {\n                rename = Some(val);\n            } else if key == \"rename_all\" {\n                rename_all = Some(val);\n            }\n        }\n    }\n\n    if let Some(explicit) = rename {\n        return explicit;\n    }\n    if let Some(style) = rename_all {\n        return apply_rename_all(fn_name, &style);\n    }\n\n    fn_name.to_string()\n}\n\n#[cfg(test)]\nmod tests {\n    use super::analyze_rust_file;\n\n    #[test]\n    fn parses_exports_and_tauri_commands() {\n        let content = r#\"\nuse crate::something::Type;\npub use crate::foo::{Bar as Baz, Quux};\npub use crate::module::*;\npub struct MyStruct;\npub enum MyEnum { A }\npub const ANSWER: u32 = 42;\npub type Alias = u64;\n\n#[tauri::command(rename = \"exposed_cmd\")]\npub async fn internal_name() {}\n\n#[tauri::command(rename_all = \"camelCase\")]\npub fn snake_case_func() {}\n        \"#;\n\n        let analysis = analyze_rust_file(content, \"src/lib.rs\".to_string());\n\n        // check reexports and public items\n        assert!(analysis\n            .reexports\n            .iter()\n            .any(|r| r.source.contains(\"foo::{Bar as Baz\")));\n        let export_names: Vec<_> = analysis.exports.iter().map(|e| e.name.clone()).collect();\n        assert!(export_names.contains(&\"MyStruct\".to_string()));\n        assert!(export_names.contains(&\"MyEnum\".to_string()));\n        assert!(export_names.contains(&\"ANSWER\".to_string()));\n        assert!(export_names.contains(&\"Alias\".to_string()));\n\n        // Tauri commands with rename/rename_all\n        let handlers: Vec<_> = analysis\n            .command_handlers\n            .iter()\n            .map(|c| c.exposed_name.clone().unwrap())\n            .collect();\n        assert!(handlers.contains(&\"exposed_cmd\".to_string()));\n        assert!(handlers.contains(&\"snakeCaseFunc\".to_string()));\n    }\n}\n\nfn parse_rust_brace_names(raw: &str) -> Vec<String> {\n    raw.split(',')\n        .filter_map(|item| {\n            let trimmed = item.trim();\n            if trimmed.is_empty() {\n                return None;\n            }\n            if trimmed == \"self\" {\n                return None;\n            }\n            if let Some((_, alias)) = trimmed.split_once(\" as \") {\n                Some(alias.trim().to_string())\n            } else {\n                Some(trimmed.to_string())\n            }\n        })\n        .collect()\n}\n\npub(crate) fn analyze_rust_file(content: &str, relative: String) -> FileAnalysis {\n    let mut imports = Vec::new();\n    for caps in regex_rust_use().captures_iter(content) {\n        let source = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").trim();\n        if !source.is_empty() {\n            imports.push(ImportEntry {\n                source: source.to_string(),\n                kind: ImportKind::Static,\n            });\n        }\n    }\n\n    let mut reexports = Vec::new();\n    let mut exports = Vec::new();\n\n    for caps in regex_rust_pub_use().captures_iter(content) {\n        let raw = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").trim();\n        if raw.is_empty() {\n            continue;\n        }\n\n        if raw.contains('{') && raw.contains('}') {\n            let mut parts = raw.splitn(2, '{');\n            let _prefix = parts.next().unwrap_or(\"\").trim().trim_end_matches(\"::\");\n            let braces = parts.next().unwrap_or(\"\").trim_end_matches('}').trim();\n            let names = parse_rust_brace_names(braces);\n            reexports.push(ReexportEntry {\n                source: raw.to_string(),\n                kind: ReexportKind::Named(names.clone()),\n                resolved: None,\n            });\n            for name in names {\n                exports.push(ExportSymbol {\n                    name,\n                    kind: \"reexport\".to_string(),\n                });\n            }\n        } else if raw.ends_with(\"::*\") {\n            reexports.push(ReexportEntry {\n                source: raw.to_string(),\n                kind: ReexportKind::Star,\n                resolved: None,\n            });\n        } else {\n            // pub use foo::bar as Baz;\n            let (path_part, export_name) = if let Some((path, alias)) = raw.split_once(\" as \") {\n                (path.trim(), alias.trim())\n            } else {\n                let mut segments = raw.rsplitn(2, \"::\");\n                let name = segments.next().unwrap_or(raw).trim();\n                let _ = segments.next();\n                (raw, name)\n            };\n\n            reexports.push(ReexportEntry {\n                source: path_part.to_string(),\n                kind: ReexportKind::Named(vec![export_name.to_string()]),\n                resolved: None,\n            });\n            exports.push(ExportSymbol {\n                name: export_name.to_string(),\n                kind: \"reexport\".to_string(),\n            });\n        }\n    }\n\n    // public items\n    for regex in rust_pub_decl_regexes() {\n        for caps in regex.captures_iter(content) {\n            if let Some(name) = caps.get(1) {\n                exports.push(ExportSymbol {\n                    name: name.as_str().to_string(),\n                    kind: \"decl\".to_string(),\n                });\n            }\n        }\n    }\n\n    for regex in rust_pub_const_regexes() {\n        for caps in regex.captures_iter(content) {\n            if let Some(name) = caps.get(1) {\n                exports.push(ExportSymbol {\n                    name: name.as_str().to_string(),\n                    kind: \"decl\".to_string(),\n                });\n            }\n        }\n    }\n\n    let mut command_handlers = Vec::new();\n    for caps in regex_tauri_command_fn().captures_iter(content) {\n        let attr_raw = caps.get(1).map(|m| m.as_str()).unwrap_or(\"\").trim();\n        let name_match = caps.get(2);\n\n        if let Some(name) = name_match {\n            let fn_name = name.as_str().to_string();\n            let exposed_name = exposed_command_name(attr_raw, &fn_name);\n\n            let line = offset_to_line(content, name.start());\n            command_handlers.push(CommandRef {\n                name: fn_name,\n                exposed_name: Some(exposed_name),\n                line,\n            });\n        }\n    }\n\n    FileAnalysis {\n        path: relative,\n        loc: 0,\n        imports,\n        reexports,\n        dynamic_imports: Vec::new(),\n        exports,\n        command_calls: Vec::new(),\n        command_handlers,\n    }\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":1}},{"line":12,"address":[],"length":0,"stats":{"Line":2}},{"line":13,"address":[],"length":0,"stats":{"Line":2}},{"line":14,"address":[],"length":0,"stats":{"Line":2}},{"line":16,"address":[],"length":0,"stats":{"Line":17}},{"line":17,"address":[],"length":0,"stats":{"Line":28}},{"line":18,"address":[],"length":0,"stats":{"Line":4}},{"line":19,"address":[],"length":0,"stats":{"Line":8}},{"line":20,"address":[],"length":0,"stats":{"Line":2}},{"line":22,"address":[],"length":0,"stats":{"Line":2}},{"line":23,"address":[],"length":0,"stats":{"Line":2}},{"line":26,"address":[],"length":0,"stats":{"Line":26}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":39}},{"line":32,"address":[],"length":0,"stats":{"Line":13}},{"line":35,"address":[],"length":0,"stats":{"Line":2}},{"line":36,"address":[],"length":0,"stats":{"Line":3}},{"line":39,"address":[],"length":0,"stats":{"Line":8}},{"line":40,"address":[],"length":0,"stats":{"Line":1}},{"line":43,"address":[],"length":0,"stats":{"Line":2}},{"line":44,"address":[],"length":0,"stats":{"Line":6}},{"line":45,"address":[],"length":0,"stats":{"Line":2}},{"line":46,"address":[],"length":0,"stats":{"Line":14}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":1}},{"line":52,"address":[],"length":0,"stats":{"Line":3}},{"line":53,"address":[],"length":0,"stats":{"Line":2}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":1}},{"line":58,"address":[],"length":0,"stats":{"Line":1}},{"line":59,"address":[],"length":0,"stats":{"Line":1}},{"line":60,"address":[],"length":0,"stats":{"Line":1}},{"line":61,"address":[],"length":0,"stats":{"Line":3}},{"line":62,"address":[],"length":0,"stats":{"Line":6}},{"line":63,"address":[],"length":0,"stats":{"Line":6}},{"line":65,"address":[],"length":0,"stats":{"Line":1}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":2}},{"line":82,"address":[],"length":0,"stats":{"Line":4}},{"line":88,"address":[],"length":0,"stats":{"Line":4}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":6}},{"line":93,"address":[],"length":0,"stats":{"Line":6}},{"line":95,"address":[],"length":0,"stats":{"Line":6}},{"line":96,"address":[],"length":0,"stats":{"Line":6}},{"line":97,"address":[],"length":0,"stats":{"Line":4}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":6}},{"line":102,"address":[],"length":0,"stats":{"Line":6}},{"line":103,"address":[],"length":0,"stats":{"Line":8}},{"line":104,"address":[],"length":0,"stats":{"Line":4}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":3}},{"line":108,"address":[],"length":0,"stats":{"Line":1}},{"line":109,"address":[],"length":0,"stats":{"Line":3}},{"line":110,"address":[],"length":0,"stats":{"Line":1}},{"line":115,"address":[],"length":0,"stats":{"Line":3}},{"line":116,"address":[],"length":0,"stats":{"Line":1}},{"line":118,"address":[],"length":0,"stats":{"Line":2}},{"line":119,"address":[],"length":0,"stats":{"Line":3}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":1}},{"line":172,"address":[],"length":0,"stats":{"Line":2}},{"line":173,"address":[],"length":0,"stats":{"Line":3}},{"line":174,"address":[],"length":0,"stats":{"Line":6}},{"line":175,"address":[],"length":0,"stats":{"Line":4}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":2}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":3}},{"line":182,"address":[],"length":0,"stats":{"Line":1}},{"line":184,"address":[],"length":0,"stats":{"Line":1}},{"line":190,"address":[],"length":0,"stats":{"Line":1}},{"line":191,"address":[],"length":0,"stats":{"Line":2}},{"line":192,"address":[],"length":0,"stats":{"Line":6}},{"line":193,"address":[],"length":0,"stats":{"Line":27}},{"line":194,"address":[],"length":0,"stats":{"Line":6}},{"line":195,"address":[],"length":0,"stats":{"Line":9}},{"line":196,"address":[],"length":0,"stats":{"Line":6}},{"line":197,"address":[],"length":0,"stats":{"Line":3}},{"line":202,"address":[],"length":0,"stats":{"Line":2}},{"line":203,"address":[],"length":0,"stats":{"Line":2}},{"line":205,"address":[],"length":0,"stats":{"Line":5}},{"line":206,"address":[],"length":0,"stats":{"Line":18}},{"line":207,"address":[],"length":0,"stats":{"Line":4}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":6}},{"line":212,"address":[],"length":0,"stats":{"Line":3}},{"line":213,"address":[],"length":0,"stats":{"Line":5}},{"line":214,"address":[],"length":0,"stats":{"Line":5}},{"line":215,"address":[],"length":0,"stats":{"Line":3}},{"line":216,"address":[],"length":0,"stats":{"Line":3}},{"line":217,"address":[],"length":0,"stats":{"Line":3}},{"line":218,"address":[],"length":0,"stats":{"Line":1}},{"line":219,"address":[],"length":0,"stats":{"Line":1}},{"line":221,"address":[],"length":0,"stats":{"Line":7}},{"line":222,"address":[],"length":0,"stats":{"Line":6}},{"line":223,"address":[],"length":0,"stats":{"Line":4}},{"line":224,"address":[],"length":0,"stats":{"Line":2}},{"line":227,"address":[],"length":0,"stats":{"Line":3}},{"line":228,"address":[],"length":0,"stats":{"Line":3}},{"line":229,"address":[],"length":0,"stats":{"Line":3}},{"line":230,"address":[],"length":0,"stats":{"Line":1}},{"line":231,"address":[],"length":0,"stats":{"Line":1}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":8}},{"line":258,"address":[],"length":0,"stats":{"Line":26}},{"line":259,"address":[],"length":0,"stats":{"Line":15}},{"line":260,"address":[],"length":0,"stats":{"Line":15}},{"line":261,"address":[],"length":0,"stats":{"Line":15}},{"line":262,"address":[],"length":0,"stats":{"Line":5}},{"line":268,"address":[],"length":0,"stats":{"Line":3}},{"line":269,"address":[],"length":0,"stats":{"Line":7}},{"line":270,"address":[],"length":0,"stats":{"Line":3}},{"line":271,"address":[],"length":0,"stats":{"Line":3}},{"line":272,"address":[],"length":0,"stats":{"Line":3}},{"line":273,"address":[],"length":0,"stats":{"Line":1}},{"line":279,"address":[],"length":0,"stats":{"Line":2}},{"line":280,"address":[],"length":0,"stats":{"Line":5}},{"line":281,"address":[],"length":0,"stats":{"Line":18}},{"line":282,"address":[],"length":0,"stats":{"Line":6}},{"line":284,"address":[],"length":0,"stats":{"Line":6}},{"line":285,"address":[],"length":0,"stats":{"Line":8}},{"line":286,"address":[],"length":0,"stats":{"Line":10}},{"line":288,"address":[],"length":0,"stats":{"Line":12}},{"line":289,"address":[],"length":0,"stats":{"Line":6}},{"line":290,"address":[],"length":0,"stats":{"Line":4}},{"line":291,"address":[],"length":0,"stats":{"Line":2}},{"line":292,"address":[],"length":0,"stats":{"Line":2}},{"line":302,"address":[],"length":0,"stats":{"Line":2}},{"line":304,"address":[],"length":0,"stats":{"Line":1}}],"covered":119,"coverable":152},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","args.rs"],"content":"use std::collections::HashSet;\nuse std::path::PathBuf;\n\nuse crate::types::{ColorMode, Mode, OutputMode, DEFAULT_LOC_THRESHOLD};\n\npub struct ParsedArgs {\n    pub extensions: Option<HashSet<String>>,\n    pub ignore_patterns: Vec<String>,\n    pub ignore_symbols: Option<HashSet<String>>,\n    pub ignore_symbols_preset: Option<String>,\n    pub focus_patterns: Vec<String>,\n    pub exclude_report_patterns: Vec<String>,\n    pub graph: bool,\n    pub use_gitignore: bool,\n    pub max_depth: Option<usize>,\n    pub color: ColorMode,\n    pub output: OutputMode,\n    pub json_output_path: Option<PathBuf>,\n    pub summary: bool,\n    pub summary_limit: usize,\n    pub show_help: bool,\n    pub show_version: bool,\n    pub root_list: Vec<PathBuf>,\n    pub show_hidden: bool,\n    pub loc_threshold: usize,\n    pub mode: Mode,\n    pub analyze_limit: usize,\n    pub report_path: Option<PathBuf>,\n    pub serve: bool,\n    pub editor_cmd: Option<String>,\n}\n\nimpl Default for ParsedArgs {\n    fn default() -> Self {\n        Self {\n            extensions: None,\n            ignore_patterns: Vec::new(),\n            ignore_symbols: None,\n            ignore_symbols_preset: None,\n            focus_patterns: Vec::new(),\n            exclude_report_patterns: Vec::new(),\n            graph: false,\n            use_gitignore: false,\n            max_depth: None,\n            color: ColorMode::Auto,\n            output: OutputMode::Human,\n            json_output_path: None,\n            summary: false,\n            summary_limit: 5,\n            show_help: false,\n            show_version: false,\n            root_list: Vec::new(),\n            show_hidden: false,\n            loc_threshold: DEFAULT_LOC_THRESHOLD,\n            mode: Mode::Tree,\n            analyze_limit: 8,\n            report_path: None,\n            serve: false,\n            editor_cmd: None,\n        }\n    }\n}\n\nfn parse_color_mode(raw: &str) -> Result<ColorMode, String> {\n    match raw {\n        \"auto\" => Ok(ColorMode::Auto),\n        \"always\" => Ok(ColorMode::Always),\n        \"never\" => Ok(ColorMode::Never),\n        _ => Err(\"--color expects auto|always|never\".to_string()),\n    }\n}\n\nfn parse_summary_limit(raw: &str) -> Result<usize, String> {\n    let value = raw\n        .parse::<usize>()\n        .map_err(|_| \"--summary expects a positive integer\".to_string())?;\n    if value == 0 {\n        Err(\"--summary expects a positive integer\".to_string())\n    } else {\n        Ok(value)\n    }\n}\n\npub fn parse_extensions(raw: &str) -> Option<HashSet<String>> {\n    let set: HashSet<String> = raw\n        .split(',')\n        .filter_map(|segment| {\n            let trimmed = segment.trim().trim_start_matches('.').to_lowercase();\n            if trimmed.is_empty() {\n                None\n            } else {\n                Some(trimmed)\n            }\n        })\n        .collect();\n    if set.is_empty() {\n        None\n    } else {\n        Some(set)\n    }\n}\n\nfn parse_glob_list(raw: &str) -> Vec<String> {\n    raw.split(',')\n        .filter_map(|segment| {\n            let trimmed = segment.trim();\n            if trimmed.is_empty() {\n                None\n            } else {\n                Some(trimmed.to_string())\n            }\n        })\n        .collect()\n}\n\npub fn parse_ignore_symbols(raw: &str) -> Option<HashSet<String>> {\n    let set: HashSet<String> = raw\n        .split(',')\n        .filter_map(|segment| {\n            let trimmed = segment.trim().to_lowercase();\n            if trimmed.is_empty() {\n                None\n            } else {\n                Some(trimmed)\n            }\n        })\n        .collect();\n    if set.is_empty() {\n        None\n    } else {\n        Some(set)\n    }\n}\n\npub fn preset_ignore_symbols(name: &str) -> Option<HashSet<String>> {\n    match name.to_lowercase().as_str() {\n        \"common\" => Some(\n            [\"main\", \"run\", \"setup\", \"test_*\", \"tests_*\"]\n                .iter()\n                .map(|s| s.to_string())\n                .collect(),\n        ),\n        _ => None,\n    }\n}\n\npub fn parse_args() -> Result<ParsedArgs, String> {\n    let args: Vec<String> = std::env::args().skip(1).collect();\n    let mut parsed = ParsedArgs {\n        ..ParsedArgs::default()\n    };\n\n    let mut roots: Vec<PathBuf> = Vec::new();\n\n    let mut i = 0;\n    while i < args.len() {\n        let arg = &args[i];\n        match arg.as_str() {\n            \"--help\" | \"-h\" => {\n                parsed.show_help = true;\n                i += 1;\n            }\n            \"--version\" | \"-V\" => {\n                parsed.show_version = true;\n                i += 1;\n            }\n            \"--color\" | \"-c\" => {\n                if let Some(next) = args.get(i + 1) {\n                    if !next.starts_with('-') {\n                        parsed.color = parse_color_mode(next)?;\n                        i += 2;\n                        continue;\n                    }\n                }\n                parsed.color = ColorMode::Always;\n                i += 1;\n            }\n            _ if arg.starts_with(\"--color=\") => {\n                let value = arg.trim_start_matches(\"--color=\");\n                parsed.color = parse_color_mode(value)?;\n                i += 1;\n            }\n            \"--gitignore\" | \"-g\" => {\n                parsed.use_gitignore = true;\n                i += 1;\n            }\n            \"--graph\" => {\n                parsed.graph = true;\n                i += 1;\n            }\n            \"--show-hidden\" | \"-H\" => {\n                parsed.show_hidden = true;\n                i += 1;\n            }\n            \"--json\" => {\n                parsed.output = OutputMode::Json;\n                if let Some(next) = args.get(i + 1) {\n                    if !next.starts_with('-') {\n                        parsed.json_output_path = Some(PathBuf::from(next));\n                        i += 2;\n                        continue;\n                    }\n                }\n                i += 1;\n            }\n            \"--json-out\" | \"--json-output\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--json-out requires a file path\".to_string())?;\n                parsed.output = OutputMode::Json;\n                parsed.json_output_path = Some(PathBuf::from(next));\n                i += 2;\n            }\n            \"--jsonl\" => {\n                parsed.output = OutputMode::Jsonl;\n                i += 1;\n            }\n            \"--html-report\" | \"--report\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--html-report requires a file path\".to_string())?;\n                parsed.report_path = Some(PathBuf::from(next));\n                i += 2;\n            }\n            \"--serve\" | \"--serve-keepalive\" | \"--serve-wait\" => {\n                parsed.serve = true;\n                i += 1;\n            }\n            \"--editor-cmd\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--editor-cmd requires a command template\".to_string())?;\n                parsed.editor_cmd = Some(next.clone());\n                i += 2;\n            }\n            \"--summary\" => {\n                parsed.summary = true;\n                if let Some(next) = args.get(i + 1) {\n                    if !next.starts_with('-') {\n                        parsed.summary_limit = parse_summary_limit(next)?;\n                        i += 2;\n                        continue;\n                    }\n                }\n                i += 1;\n            }\n            _ if arg.starts_with(\"--summary=\") => {\n                let value = arg.trim_start_matches(\"--summary=\");\n                parsed.summary = true;\n                parsed.summary_limit = parse_summary_limit(value)?;\n                i += 1;\n            }\n            \"--loc\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--loc requires a positive integer\".to_string())?;\n                let value = next\n                    .parse::<usize>()\n                    .map_err(|_| \"--loc requires a positive integer\".to_string())?;\n                if value == 0 {\n                    return Err(\"--loc requires a positive integer\".to_string());\n                }\n                parsed.loc_threshold = value;\n                i += 2;\n            }\n            \"--limit\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--limit requires a positive integer\".to_string())?;\n                let value = next\n                    .parse::<usize>()\n                    .map_err(|_| \"--limit requires a positive integer\".to_string())?;\n                if value == 0 {\n                    return Err(\"--limit requires a positive integer\".to_string());\n                }\n                parsed.analyze_limit = value;\n                i += 2;\n            }\n            \"--analyze-imports\" | \"-A\" => {\n                parsed.mode = Mode::AnalyzeImports;\n                i += 1;\n            }\n            \"-L\" | \"--max-depth\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"-L/--max-depth requires a non-negative integer\".to_string())?;\n                let depth = next\n                    .parse::<usize>()\n                    .map_err(|_| \"-L/--max-depth requires a non-negative integer\".to_string())?;\n                parsed.max_depth = Some(depth);\n                i += 2;\n            }\n            \"--ext\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--ext requires a comma-separated value\".to_string())?;\n                parsed.extensions = parse_extensions(next);\n                i += 2;\n            }\n            _ if arg.starts_with(\"--ext=\") => {\n                let value = arg.trim_start_matches(\"--ext=\");\n                parsed.extensions = parse_extensions(value);\n                i += 1;\n            }\n            \"--ignore-symbols\" => {\n                let next = args.get(i + 1).ok_or_else(|| {\n                    \"--ignore-symbols requires a comma-separated list\".to_string()\n                })?;\n                parsed.ignore_symbols = parse_ignore_symbols(next);\n                i += 2;\n            }\n            _ if arg.starts_with(\"--ignore-symbols=\") => {\n                let value = arg.trim_start_matches(\"--ignore-symbols=\");\n                parsed.ignore_symbols = parse_ignore_symbols(value);\n                i += 1;\n            }\n            \"--ignore-symbols-preset\" => {\n                let next = args.get(i + 1).ok_or_else(|| {\n                    \"--ignore-symbols-preset requires a name (e.g. common)\".to_string()\n                })?;\n                parsed.ignore_symbols_preset = Some(next.clone());\n                i += 2;\n            }\n            _ if arg.starts_with(\"--ignore-symbols-preset=\") => {\n                let value = arg.trim_start_matches(\"--ignore-symbols-preset=\");\n                parsed.ignore_symbols_preset = Some(value.to_string());\n                i += 1;\n            }\n            \"--focus\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--focus requires a glob or comma list\".to_string())?;\n                parsed.focus_patterns.extend(parse_glob_list(next));\n                i += 2;\n            }\n            _ if arg.starts_with(\"--focus=\") => {\n                let value = arg.trim_start_matches(\"--focus=\");\n                parsed.focus_patterns.extend(parse_glob_list(value));\n                i += 1;\n            }\n            \"--exclude-report\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"--exclude-report requires a glob or comma list\".to_string())?;\n                parsed.exclude_report_patterns.extend(parse_glob_list(next));\n                i += 2;\n            }\n            _ if arg.starts_with(\"--exclude-report=\") => {\n                let value = arg.trim_start_matches(\"--exclude-report=\");\n                parsed\n                    .exclude_report_patterns\n                    .extend(parse_glob_list(value));\n                i += 1;\n            }\n            \"-I\" | \"--ignore\" => {\n                let next = args\n                    .get(i + 1)\n                    .ok_or_else(|| \"-I/--ignore requires a path argument\".to_string())?;\n                parsed.ignore_patterns.push(next.clone());\n                i += 2;\n            }\n            _ if arg.starts_with('-') => {\n                eprintln!(\"Ignoring unknown flag {}\", arg);\n                i += 1;\n            }\n            _ => {\n                let trimmed = arg.trim();\n                if !trimmed.is_empty() {\n                    roots.push(PathBuf::from(trimmed));\n                }\n                i += 1;\n            }\n        }\n    }\n\n    if roots.is_empty() {\n        roots.push(PathBuf::from(\".\"));\n    }\n    parsed.root_list = roots;\n\n    Ok(parsed)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_parse_extensions() {\n        let res = parse_extensions(\"rs,ts\").unwrap();\n        assert!(res.contains(\"rs\"));\n        assert!(res.contains(\"ts\"));\n        assert_eq!(res.len(), 2);\n    }\n\n    #[test]\n    fn test_parse_extensions_empty() {\n        assert!(parse_extensions(\"\").is_none());\n    }\n\n    #[test]\n    fn test_parse_color_mode() {\n        assert_eq!(parse_color_mode(\"always\").unwrap(), ColorMode::Always);\n        assert_eq!(parse_color_mode(\"never\").unwrap(), ColorMode::Never);\n        assert!(parse_color_mode(\"invalid\").is_err());\n    }\n\n    #[test]\n    fn test_parse_summary_limit() {\n        assert_eq!(parse_summary_limit(\"5\").unwrap(), 5);\n        assert!(parse_summary_limit(\"0\").is_err());\n        assert!(parse_summary_limit(\"abc\").is_err());\n    }\n}\n","traces":[{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":3}},{"line":65,"address":[],"length":0,"stats":{"Line":3}},{"line":66,"address":[],"length":0,"stats":{"Line":3}},{"line":67,"address":[],"length":0,"stats":{"Line":4}},{"line":68,"address":[],"length":0,"stats":{"Line":3}},{"line":69,"address":[],"length":0,"stats":{"Line":1}},{"line":73,"address":[],"length":0,"stats":{"Line":3}},{"line":74,"address":[],"length":0,"stats":{"Line":5}},{"line":76,"address":[],"length":0,"stats":{"Line":6}},{"line":77,"address":[],"length":0,"stats":{"Line":2}},{"line":78,"address":[],"length":0,"stats":{"Line":1}},{"line":80,"address":[],"length":0,"stats":{"Line":1}},{"line":84,"address":[],"length":0,"stats":{"Line":2}},{"line":85,"address":[],"length":0,"stats":{"Line":6}},{"line":87,"address":[],"length":0,"stats":{"Line":5}},{"line":88,"address":[],"length":0,"stats":{"Line":9}},{"line":89,"address":[],"length":0,"stats":{"Line":6}},{"line":90,"address":[],"length":0,"stats":{"Line":1}},{"line":92,"address":[],"length":0,"stats":{"Line":2}},{"line":96,"address":[],"length":0,"stats":{"Line":4}},{"line":97,"address":[],"length":0,"stats":{"Line":1}},{"line":99,"address":[],"length":0,"stats":{"Line":1}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":322,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":326,"address":[],"length":0,"stats":{"Line":0}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":334,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":337,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":339,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":355,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":362,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":364,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":368,"address":[],"length":0,"stats":{"Line":0}},{"line":369,"address":[],"length":0,"stats":{"Line":0}},{"line":371,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":379,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}}],"covered":22,"coverable":229},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","fs_utils.rs"],"content":"use std::cmp::Ordering;\nuse std::fs::{self, File};\nuse std::io::{self, BufRead, BufReader};\nuse std::path::{Path, PathBuf};\nuse std::process::{Command, Stdio};\n\nuse crate::types::Options;\n\npub struct GitIgnoreChecker {\n    repo_root: PathBuf,\n}\n\nimpl GitIgnoreChecker {\n    pub fn new(root: &Path) -> Option<Self> {\n        let output = Command::new(\"git\")\n            .arg(\"-C\")\n            .arg(root)\n            .arg(\"rev-parse\")\n            .arg(\"--show-toplevel\")\n            .stdout(Stdio::piped())\n            .stderr(Stdio::null())\n            .output()\n            .ok()?;\n        if !output.status.success() {\n            return None;\n        }\n        let path_str = String::from_utf8_lossy(&output.stdout).trim().to_string();\n        let repo_root = PathBuf::from(path_str);\n        Some(Self { repo_root })\n    }\n\n    pub fn is_ignored(&self, full_path: &Path) -> bool {\n        if full_path.as_os_str().is_empty() {\n            return false;\n        }\n        let relative = full_path.strip_prefix(&self.repo_root).unwrap_or(full_path);\n        Command::new(\"git\")\n            .arg(\"-C\")\n            .arg(&self.repo_root)\n            .arg(\"check-ignore\")\n            .arg(\"-q\")\n            .arg(relative)\n            .stdout(Stdio::null())\n            .stderr(Stdio::null())\n            .status()\n            .map(|status| status.success())\n            .unwrap_or(false)\n    }\n}\n\npub fn normalise_ignore_patterns(patterns: &[String], root: &Path) -> Vec<PathBuf> {\n    patterns\n        .iter()\n        .map(|pattern| {\n            let candidate = PathBuf::from(pattern);\n            let full = if candidate.is_absolute() {\n                candidate\n            } else {\n                root.join(candidate)\n            };\n            full.canonicalize().unwrap_or(full)\n        })\n        .collect()\n}\n\npub fn count_lines(path: &Path) -> Option<usize> {\n    let file = File::open(path).ok()?;\n    let reader = BufReader::new(file);\n    let mut count = 0usize;\n    for line in reader.lines() {\n        if line.is_ok() {\n            count += 1;\n        }\n    }\n    Some(count)\n}\n\npub fn matches_extension(\n    path: &Path,\n    extensions: Option<&std::collections::HashSet<String>>,\n) -> bool {\n    match extensions {\n        None => true,\n        Some(set) => path\n            .extension()\n            .and_then(|ext| ext.to_str())\n            .map(|ext| set.contains(&ext.to_lowercase()))\n            .unwrap_or(false),\n    }\n}\n\npub fn should_ignore(\n    full_path: &Path,\n    options: &Options,\n    git_checker: Option<&GitIgnoreChecker>,\n) -> bool {\n    if options\n        .ignore_paths\n        .iter()\n        .any(|ignored| full_path.starts_with(ignored))\n    {\n        return true;\n    }\n    if options.use_gitignore {\n        if let Some(checker) = git_checker {\n            if checker.is_ignored(full_path) {\n                return true;\n            }\n        }\n    }\n    false\n}\n\npub fn gather_files(\n    dir: &Path,\n    options: &Options,\n    depth: usize,\n    git_checker: Option<&GitIgnoreChecker>,\n    files: &mut Vec<PathBuf>,\n) -> io::Result<()> {\n    let mut dir_entries: Vec<_> = fs::read_dir(dir)?\n        .filter_map(Result::ok)\n        .filter(|entry| {\n            let name = entry.file_name();\n            let is_hidden = name.to_string_lossy().starts_with('.');\n            options.show_hidden || !is_hidden\n        })\n        .collect();\n\n    dir_entries.sort_by(|a, b| {\n        a.file_name()\n            .to_string_lossy()\n            .to_lowercase()\n            .cmp(&b.file_name().to_string_lossy().to_lowercase())\n    });\n\n    for entry in dir_entries {\n        let path = entry.path();\n        if should_ignore(&path, options, git_checker) {\n            continue;\n        }\n        if path.is_file() {\n            if matches_extension(&path, options.extensions.as_ref()) {\n                files.push(path);\n            }\n            continue;\n        }\n        if path.is_dir() && options.max_depth.is_none_or(|max| depth < max) {\n            gather_files(&path, options, depth + 1, git_checker, files)?;\n        }\n    }\n\n    Ok(())\n}\n\npub fn sort_dir_entries(entries: &mut [std::fs::DirEntry]) {\n    entries.sort_by(|a, b| {\n        let a_path = a.path();\n        let b_path = b.path();\n        let a_is_dir = a_path.is_dir();\n        let b_is_dir = b_path.is_dir();\n        match (a_is_dir, b_is_dir) {\n            (true, false) => Ordering::Less,\n            (false, true) => Ordering::Greater,\n            _ => a\n                .file_name()\n                .to_string_lossy()\n                .to_lowercase()\n                .cmp(&b.file_name().to_string_lossy().to_lowercase()),\n        }\n    });\n}\n\n#[cfg(test)]\nmod tests {\n    use super::gather_files;\n    use crate::types::{ColorMode, Options, OutputMode};\n    use std::collections::HashSet;\n\n    fn opts_with_ext(ext: &str) -> Options {\n        Options {\n            extensions: Some(HashSet::from([ext.to_string()])),\n            ignore_paths: Vec::new(),\n            use_gitignore: false,\n            max_depth: Some(1),\n            color: ColorMode::Never,\n            output: OutputMode::Human,\n            summary: false,\n            summary_limit: 5,\n            show_hidden: false,\n            loc_threshold: crate::types::DEFAULT_LOC_THRESHOLD,\n            analyze_limit: 8,\n            report_path: None,\n            serve: false,\n            editor_cmd: None,\n        }\n    }\n\n    #[test]\n    fn gather_files_filters_by_extension_and_depth() {\n        let root = std::env::temp_dir().join(\"loctree_fs_utils\");\n        let _ = std::fs::remove_dir_all(&root);\n        std::fs::create_dir_all(root.join(\"nested\")).unwrap();\n        std::fs::write(root.join(\"keep.rs\"), \"// ok\").unwrap();\n        std::fs::write(root.join(\"skip.txt\"), \"// skip\").unwrap();\n        std::fs::write(root.join(\".hidden.rs\"), \"// hidden\").unwrap();\n        std::fs::write(root.join(\"nested\").join(\"deep.rs\"), \"// deep\").unwrap();\n\n        let mut files = Vec::new();\n        let opts = opts_with_ext(\"rs\");\n        gather_files(&root, &opts, 0, None, &mut files).unwrap();\n\n        let as_strings: Vec<String> = files\n            .iter()\n            .map(|p| p.file_name().unwrap().to_string_lossy().to_string())\n            .collect();\n        assert!(as_strings.contains(&\"keep.rs\".to_string()));\n        assert!(!as_strings.contains(&\"skip.txt\".to_string()));\n        assert!(as_strings.contains(&\"deep.rs\".to_string()));\n        assert!(!as_strings.contains(&\".hidden.rs\".to_string()));\n\n        let _ = std::fs::remove_dir_all(&root);\n    }\n}\n","traces":[{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":3}},{"line":82,"address":[],"length":0,"stats":{"Line":3}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":6}},{"line":86,"address":[],"length":0,"stats":{"Line":9}},{"line":87,"address":[],"length":0,"stats":{"Line":12}},{"line":92,"address":[],"length":0,"stats":{"Line":4}},{"line":97,"address":[],"length":0,"stats":{"Line":4}},{"line":98,"address":[],"length":0,"stats":{"Line":4}},{"line":100,"address":[],"length":0,"stats":{"Line":4}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":4}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":4}},{"line":114,"address":[],"length":0,"stats":{"Line":2}},{"line":121,"address":[],"length":0,"stats":{"Line":8}},{"line":122,"address":[],"length":0,"stats":{"Line":2}},{"line":123,"address":[],"length":0,"stats":{"Line":7}},{"line":124,"address":[],"length":0,"stats":{"Line":15}},{"line":125,"address":[],"length":0,"stats":{"Line":10}},{"line":126,"address":[],"length":0,"stats":{"Line":10}},{"line":130,"address":[],"length":0,"stats":{"Line":7}},{"line":131,"address":[],"length":0,"stats":{"Line":3}},{"line":132,"address":[],"length":0,"stats":{"Line":3}},{"line":133,"address":[],"length":0,"stats":{"Line":3}},{"line":134,"address":[],"length":0,"stats":{"Line":6}},{"line":137,"address":[],"length":0,"stats":{"Line":10}},{"line":138,"address":[],"length":0,"stats":{"Line":12}},{"line":139,"address":[],"length":0,"stats":{"Line":16}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":4}},{"line":143,"address":[],"length":0,"stats":{"Line":14}},{"line":144,"address":[],"length":0,"stats":{"Line":4}},{"line":146,"address":[],"length":0,"stats":{"Line":3}},{"line":148,"address":[],"length":0,"stats":{"Line":5}},{"line":149,"address":[],"length":0,"stats":{"Line":6}},{"line":153,"address":[],"length":0,"stats":{"Line":2}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}}],"covered":33,"coverable":89},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","main.rs"],"content":"mod analyzer;\nmod args;\nmod fs_utils;\nmod tree;\nmod types;\n\nuse std::panic;\nuse std::path::PathBuf;\n\nuse args::parse_args;\nuse types::Mode;\n\nfn install_broken_pipe_handler() {\n    let default_hook = panic::take_hook();\n    panic::set_hook(Box::new(move |info| {\n        let payload = info.payload();\n        let is_broken = payload\n            .downcast_ref::<&str>()\n            .is_some_and(|s| s.contains(\"Broken pipe\"))\n            || payload\n                .downcast_ref::<String>()\n                .is_some_and(|s| s.contains(\"Broken pipe\"));\n\n        if is_broken {\n            // Quietly exit when downstream closes the pipe (e.g. piping to `head`).\n            std::process::exit(0);\n        }\n\n        default_hook(info);\n    }));\n}\n\nfn format_usage() -> &'static str {\n    \"loctree (Rust)\\n\\nUsage: loctree [root ...] [options]\\n\\nModes:\\n  --analyze-imports, -A  Switch to import/export analyzer (reports re-exports, duplicate exports, dynamic imports).\\n\\nOptions:\\n  --ext <list>         Comma-separated extensions to include (e.g. --ext rs,ts,tsx,py,css).\\n                       Prunes non-matching files/dirs from the tree or the analyzer input set.\\n                       Analyzer defaults: ts,tsx,js,jsx,mjs,cjs,rs,css,py when --ext is omitted.\\n  -I, --ignore <path>  Ignore a folder/file (relative or absolute). Repeatable.\\n  --gitignore, -g      Respect current Git ignore rules (requires git).\\n  -L, --max-depth <n>  Limit recursion depth (0 = only direct children).\\n  --color[=mode]       Colorize large files. mode: auto|always|never (default auto).\\n  --loc <n>            Threshold (LOC) for large-file highlighting (tree mode). Default 1000.\\n  --show-hidden, -H    Include dotfiles.\\n  --json               Emit JSON instead of a tree view (single root => object, multi-root => array).\\n  --jsonl              Emit one JSON object per line (per root) in analyzer mode.\\n  --html-report <file> Write analyzer results to an HTML report file.\\n  --graph              Embed an import graph into the HTML report (Cytoscape.js from CDN).\\n  --serve              Start a lightweight local server so HTML links can open files in your editor/OS handler.\\n  --editor-cmd <tpl>   Command template to open files (default tries: code -g {file}:{line}, else open/xdg-open).\\n  --ignore-symbols <l> Analyzer: comma-separated symbols to skip when counting duplicate exports (case-insensitive).\\n  --ignore-symbols-preset <name> Analyzer: predefined set (e.g. common => main,run,setup,test_*).\\n  --focus <glob[,..]>  Analyzer: filter duplicate-export rows to files matching these globs (report/output filter only).\\n  --exclude-report <glob[,..]> Analyzer: drop duplicate rows whose files match these globs (e.g. **/__tests__/**).\\n  --summary[=N]        Tree: totals + top large files (N entries, default 5).\\n  --limit <N>          Analyzer: top-N duplicate exports / dynamic imports (default 8).\\n  --help, -h           Show this message.\\n\\nExamples:\\n  loctree src --ext rs,ts --summary\\n  loctree src packages/app src-tauri/src -I node_modules -L 2\\n  loctree . --json > tree.json\\n  loctree src apps/web -A --json --ext ts,tsx,css --limit 10 --serve --html-report /tmp/loctree.html\\n  loctree backend -A --ext py --gitignore --limit 5\\n  loctree . -A --ext py --ignore-symbols main,run\\n  loctree . -A --ext py --ignore-symbols-preset common --graph --html-report /tmp/loctree.html\\n\"\n}\n\nfn main() -> std::io::Result<()> {\n    install_broken_pipe_handler();\n\n    let parsed = match parse_args() {\n        Ok(args) => args,\n        Err(err) => {\n            eprintln!(\"{}\", err);\n            std::process::exit(1);\n        }\n    };\n\n    if parsed.show_help {\n        println!(\"{}\", format_usage());\n        return Ok(());\n    }\n\n    if parsed.show_version {\n        println!(\"loctree {}\", env!(\"CARGO_PKG_VERSION\"));\n        return Ok(());\n    }\n\n    if parsed.max_depth.is_some() && parsed.max_depth.unwrap_or(0) == usize::MAX {\n        eprintln!(\"Invalid max depth\");\n        std::process::exit(1);\n    }\n\n    let mut root_list: Vec<PathBuf> = Vec::new();\n    let cwd = std::env::current_dir().unwrap_or_else(|_| PathBuf::from(\".\"));\n    for root in parsed.root_list.iter() {\n        if !root.is_dir() {\n            let raw = if root.as_os_str().is_empty() {\n                \"<empty>\".to_string()\n            } else {\n                root.display().to_string()\n            };\n            eprintln!(\n                \"Root \\\"{}\\\" (cwd: {}) is not a directory\",\n                raw,\n                cwd.display()\n            );\n            std::process::exit(1);\n        }\n        root_list.push(root.canonicalize().unwrap_or_else(|_| root.clone()));\n    }\n\n    match parsed.mode {\n        Mode::AnalyzeImports => analyzer::run_import_analyzer(&root_list, &parsed)?,\n        Mode::Tree => tree::run_tree(&root_list, &parsed)?,\n    }\n\n    Ok(())\n}\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":47},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","tree.rs"],"content":"use std::io;\nuse std::path::{Path, PathBuf};\n\nuse serde_json::json;\nuse std::io::IsTerminal;\n\nuse crate::fs_utils::{\n    count_lines, normalise_ignore_patterns, should_ignore, sort_dir_entries, GitIgnoreChecker,\n};\nuse crate::types::{\n    Collectors, ColorMode, LargeEntry, LineEntry, Options, OutputMode, Stats, COLOR_RED,\n    COLOR_RESET,\n};\n\nfn walk(\n    dir: &Path,\n    options: &Options,\n    prefix_parts: &mut Vec<bool>,\n    collectors: &mut Collectors,\n    depth: usize,\n    root: &Path,\n    git_checker: Option<&GitIgnoreChecker>,\n) -> io::Result<bool> {\n    let mut dir_entries: Vec<_> = std::fs::read_dir(dir)?\n        .filter_map(Result::ok)\n        .filter(|entry| {\n            let name = entry.file_name();\n            let is_hidden = name.to_string_lossy().starts_with('.');\n            options.show_hidden || !is_hidden\n        })\n        .collect();\n\n    sort_dir_entries(dir_entries.as_mut_slice());\n\n    let len = dir_entries.len();\n    let mut any_included = false;\n    for (idx, entry) in dir_entries.into_iter().enumerate() {\n        let path = entry.path();\n        let is_last = idx + 1 == len;\n        let mut prefix = String::new();\n        for &has_more in prefix_parts.iter() {\n            if has_more {\n                prefix.push_str(\"│   \");\n            } else {\n                prefix.push_str(\"    \");\n            }\n        }\n        let branch = if is_last { \"└── \" } else { \"├── \" };\n        let name = entry.file_name().to_string_lossy().to_string();\n        let label = format!(\"{}{}{}\", prefix, branch, name);\n\n        let relative = path.strip_prefix(root).unwrap_or(&path).to_path_buf();\n        if should_ignore(&path, options, git_checker) {\n            continue;\n        }\n\n        let mut loc = None;\n        let is_dir = path.is_dir();\n        let mut include_current = false;\n\n        if path.is_file() {\n            let ext = path\n                .extension()\n                .and_then(|ext| ext.to_str())\n                .unwrap_or(\"\")\n                .to_lowercase();\n            let matches_ext = options\n                .extensions\n                .as_ref()\n                .is_none_or(|set| set.contains(&ext));\n            if matches_ext {\n                loc = count_lines(&path);\n                if let Some(value) = loc {\n                    collectors.stats.files += 1;\n                    collectors.stats.files_with_loc += 1;\n                    collectors.stats.total_loc += value;\n                    if value >= options.loc_threshold {\n                        let relative_display = if relative.as_os_str().is_empty() {\n                            name.clone()\n                        } else {\n                            relative.to_string_lossy().to_string()\n                        };\n                        collectors.large_entries.push(LargeEntry {\n                            path: relative_display.clone(),\n                            loc: value,\n                        });\n                    }\n                    include_current = true;\n                }\n            }\n        }\n\n        let relative_display = if relative.as_os_str().is_empty() {\n            name.clone()\n        } else {\n            relative.to_string_lossy().to_string()\n        };\n        let is_large = loc.is_some_and(|v| v >= options.loc_threshold);\n\n        if is_dir && options.max_depth.is_none_or(|max| depth < max) {\n            prefix_parts.push(!is_last);\n            let child_has = walk(\n                &path,\n                options,\n                prefix_parts,\n                collectors,\n                depth + 1,\n                root,\n                git_checker,\n            )?;\n            prefix_parts.pop();\n            if child_has {\n                collectors.stats.directories += 1;\n                include_current = true;\n            }\n        }\n\n        if include_current {\n            collectors.entries.push(LineEntry {\n                label,\n                loc,\n                relative_path: relative_display,\n                is_dir,\n                is_large,\n            });\n            any_included = true;\n        }\n    }\n\n    Ok(any_included)\n}\n\npub fn run_tree(root_list: &[PathBuf], parsed: &crate::args::ParsedArgs) -> io::Result<()> {\n    let options = Options {\n        extensions: parsed.extensions.clone(),\n        ignore_paths: Vec::new(),\n        use_gitignore: parsed.use_gitignore,\n        max_depth: parsed.max_depth,\n        color: parsed.color,\n        output: parsed.output,\n        summary: parsed.summary,\n        summary_limit: parsed.summary_limit,\n        show_hidden: parsed.show_hidden,\n        loc_threshold: parsed.loc_threshold,\n        analyze_limit: parsed.analyze_limit,\n        report_path: None,\n        serve: false,\n        editor_cmd: None,\n    };\n\n    let mut json_results = Vec::new();\n\n    for (idx, root_path) in root_list.iter().enumerate() {\n        let ignore_paths = normalise_ignore_patterns(&parsed.ignore_patterns, root_path);\n        let root_options = Options {\n            ignore_paths,\n            loc_threshold: parsed.loc_threshold,\n            ..options.clone()\n        };\n\n        let git_checker = if root_options.use_gitignore {\n            GitIgnoreChecker::new(root_path)\n        } else {\n            None\n        };\n\n        let mut entries: Vec<LineEntry> = Vec::new();\n        let mut large_entries: Vec<LargeEntry> = Vec::new();\n        let mut prefix_parts: Vec<bool> = Vec::new();\n        let mut stats = Stats::default();\n\n        let mut collectors = Collectors {\n            entries: &mut entries,\n            large_entries: &mut large_entries,\n            stats: &mut stats,\n        };\n\n        walk(\n            root_path,\n            &root_options,\n            &mut prefix_parts,\n            &mut collectors,\n            0,\n            root_path,\n            git_checker.as_ref(),\n        )?;\n\n        let mut sorted_large = large_entries;\n        sorted_large.sort_by(|a, b| b.loc.cmp(&a.loc));\n\n        let summary = json!({\n            \"directories\": stats.directories,\n            \"files\": stats.files,\n            \"filesWithLoc\": stats.files_with_loc,\n            \"totalLoc\": stats.total_loc,\n            \"largeFiles\": sorted_large\n                .iter()\n                .take(root_options.summary_limit)\n                .map(|e| json!({\"path\": e.path, \"loc\": e.loc}))\n                .collect::<Vec<_>>()\n        });\n\n        if matches!(root_options.output, OutputMode::Json | OutputMode::Jsonl) {\n            let entries_json: Vec<_> = entries\n                .iter()\n                .map(|entry| {\n                    json!({\n                        \"path\": entry.relative_path,\n                        \"type\": if entry.is_dir { \"dir\" } else { \"file\" },\n                        \"loc\": entry.loc,\n                        \"isLarge\": entry.is_large,\n                    })\n                })\n                .collect();\n\n            let payload = json!({\n                \"root\": root_path,\n                \"options\": {\n                    \"exts\": root_options.extensions.as_ref().map(|set| {\n                        let mut exts: Vec<_> = set.iter().cloned().collect();\n                        exts.sort();\n                        exts\n                    }),\n                    \"ignore\": root_options\n                        .ignore_paths\n                        .iter()\n                        .map(|p| p.display().to_string())\n                        .collect::<Vec<_>>(),\n                    \"maxDepth\": root_options.max_depth,\n                    \"useGitignore\": root_options.use_gitignore,\n                    \"color\": match root_options.color {\n                        ColorMode::Auto => \"auto\",\n                        ColorMode::Always => \"always\",\n                        ColorMode::Never => \"never\",\n                    },\n                    \"summary\": if root_options.summary {\n                        serde_json::Value::from(root_options.summary_limit)\n                    } else {\n                        serde_json::Value::Bool(false)\n                    },\n                },\n                \"summary\": summary,\n                \"entries\": entries_json,\n            });\n\n            if matches!(root_options.output, OutputMode::Jsonl) {\n                println!(\"{}\", serde_json::to_string(&payload).unwrap());\n            } else {\n                json_results.push(payload);\n            }\n            continue;\n        }\n\n        if idx > 0 {\n            println!();\n        }\n\n        if entries.is_empty() {\n            println!(\"{}/ (empty)\", root_path.display());\n            continue;\n        }\n\n        let max_label_len = entries\n            .iter()\n            .map(|entry| entry.label.len())\n            .max()\n            .unwrap_or(0);\n        let root_name = root_path\n            .file_name()\n            .map(|name| name.to_string_lossy().into_owned())\n            .unwrap_or_else(|| root_path.display().to_string());\n\n        let color_enabled = matches!(root_options.color, ColorMode::Always)\n            || (matches!(root_options.color, ColorMode::Auto) && std::io::stdout().is_terminal());\n\n        println!(\"{}/\", root_name);\n        for entry in &entries {\n            if let Some(loc) = entry.loc {\n                let line = format!(\"{:<width$}  {:>6}\", entry.label, loc, width = max_label_len);\n                if color_enabled && entry.is_large {\n                    println!(\"{}{}{}\", COLOR_RED, line, COLOR_RESET);\n                } else {\n                    println!(\"{}\", line);\n                }\n            } else {\n                println!(\"{}\", entry.label);\n            }\n        }\n\n        if !sorted_large.is_empty() {\n            println!(\"\\nLarge files (>= {} LOC):\", root_options.loc_threshold);\n            for item in &sorted_large {\n                let summary_line = format!(\"  {} ({} LOC)\", item.path, item.loc);\n                if color_enabled {\n                    println!(\"{}{}{}\", COLOR_RED, summary_line, COLOR_RESET);\n                } else {\n                    println!(\"{}\", summary_line);\n                }\n            }\n        }\n\n        if root_options.summary {\n            println!(\n                \"\\nSummary: directories: {}, files: {}, files with LOC: {}, total LOC: {}\",\n                stats.directories, stats.files, stats.files_with_loc, stats.total_loc\n            );\n            if sorted_large.is_empty() {\n                println!(\"No files exceed the large-file threshold.\");\n            }\n        }\n    }\n\n    if matches!(options.output, OutputMode::Json) {\n        if json_results.len() == 1 {\n            println!(\n                \"{}\",\n                serde_json::to_string_pretty(&json_results[0]).unwrap()\n            );\n        } else {\n            println!(\"{}\", serde_json::to_string_pretty(&json_results).unwrap());\n        }\n    }\n\n    Ok(())\n}\n","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":191},{"path":["/","Users","maciejgad","hosted","loctree","loctree_rs","src","types.rs"],"content":"use std::collections::{HashMap, HashSet};\n\npub const DEFAULT_LOC_THRESHOLD: usize = 1000;\npub const COLOR_RED: &str = \"\\u{001b}[31m\";\npub const COLOR_RESET: &str = \"\\u{001b}[0m\";\n\n#[derive(Clone, Copy, PartialEq, Eq, Debug)]\npub enum ColorMode {\n    Auto,\n    Always,\n    Never,\n}\n\n#[derive(Clone, Copy, PartialEq, Eq, Debug)]\npub enum OutputMode {\n    Human,\n    Json,\n    Jsonl,\n}\n\n#[derive(Clone, Copy, PartialEq, Eq, Debug)]\npub enum Mode {\n    Tree,\n    AnalyzeImports,\n}\n\n#[derive(Clone)]\npub struct Options {\n    pub extensions: Option<HashSet<String>>,\n    pub ignore_paths: Vec<std::path::PathBuf>,\n    pub use_gitignore: bool,\n    pub max_depth: Option<usize>,\n    pub color: ColorMode,\n    pub output: OutputMode,\n    pub summary: bool,\n    pub summary_limit: usize,\n    pub show_hidden: bool,\n    pub loc_threshold: usize,\n    pub analyze_limit: usize,\n    pub report_path: Option<std::path::PathBuf>,\n    pub serve: bool,\n    #[allow(dead_code)]\n    pub editor_cmd: Option<String>,\n}\n\npub struct LineEntry {\n    pub label: String,\n    pub loc: Option<usize>,\n    pub relative_path: String,\n    pub is_dir: bool,\n    pub is_large: bool,\n}\n\npub struct LargeEntry {\n    pub path: String,\n    pub loc: usize,\n}\n\n#[derive(Default)]\npub struct Stats {\n    pub directories: usize,\n    pub files: usize,\n    pub files_with_loc: usize,\n    pub total_loc: usize,\n}\n\npub struct Collectors<'a> {\n    pub entries: &'a mut Vec<LineEntry>,\n    pub large_entries: &'a mut Vec<LargeEntry>,\n    pub stats: &'a mut Stats,\n}\n\n#[derive(Clone)]\npub struct ImportEntry {\n    pub source: String,\n    pub kind: ImportKind,\n}\n\n#[derive(Clone)]\npub enum ImportKind {\n    Static,\n    SideEffect,\n}\n\n#[derive(Clone)]\npub struct ReexportEntry {\n    pub source: String,\n    pub kind: ReexportKind,\n    pub resolved: Option<String>,\n}\n\n#[derive(Clone)]\npub enum ReexportKind {\n    Star,\n    Named(Vec<String>),\n}\n\n#[derive(Clone)]\npub struct ExportSymbol {\n    pub name: String,\n    pub kind: String,\n}\n\n#[derive(Clone)]\npub struct CommandRef {\n    pub name: String,\n    pub exposed_name: Option<String>,\n    pub line: usize,\n}\n\n#[derive(Clone)]\npub struct FileAnalysis {\n    pub path: String,\n    pub loc: usize,\n    pub imports: Vec<ImportEntry>,\n    pub reexports: Vec<ReexportEntry>,\n    pub dynamic_imports: Vec<String>,\n    pub exports: Vec<ExportSymbol>,\n    pub command_calls: Vec<CommandRef>,\n    pub command_handlers: Vec<CommandRef>,\n}\n\n// Convenience type aliases reused across modules\npub type ExportIndex = HashMap<String, Vec<String>>;\n","traces":[],"covered":0,"coverable":0}],"coverage":22.22835079977937,"covered":403,"coverable":1813}